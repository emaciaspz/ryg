<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: bitacora/bitacora.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: bitacora/bitacora.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>var isFacturable = false;
var salir = false;
var bitacoraLog = getLogger('bitacora');

/**
 * @typedef BitacoraParams
 * @property {string|any} id
 * @property {string|any} fecha_orden
 * @property {string|any} fecha
 * @property {string|any} gestion
 * @property {string|any} tiempo
 * @property {string|any} comentario
 * @property {string|any} usuario
 * @property {string|any} subtarea
 * @property {string|any} bitacora_caso
 * @property {string|any} fk_idSiniestro
 * @property {string|any} bitacora_observacion
 * @property {string|any} anio
 * @property {string|any} mes
 * @property {string|any} dia
 * @property {string|any} bitacora_accion
 * @property {string|any} objetivo
 * @property {string|any} bitacora_tiempo
 */
/**
 * Funcion que muestra los datos de la bitacora
 *
 */
function bitacora() {
    var numSin = window.localStorage.getItem("idSiniestroServidor");
    window.localStorage.removeItem("idBitacoraLocal"); //Inicio sesión
    fn.load('bitacora.html');
    bitacoraLog.debug('consultando bitacoras', {conexion: verificarConexion(), synced: isSynced(), numSin});
    if (verificarConexion() == true &amp;&amp; (isSynced() == true || isSynced() == "true")) {
        sendGetRequest('siniestro_bitacora.php?caso=' + numSin, function (lstBitacoras) {
            // convertir fechas a yyyy-mm-dd
            lstBitacoras.resultados = lstBitacoras.resultados.map(b => {
                let parte = b.fecha.split('-');
                if (parte[1].length &lt; 2) {
                    parte[1] = '0' + parte[1]
                }
                if (parte[2].length &lt; 2) {
                    parte[2] = '0' + parte[2]
                }
                b.fecha = parte[0] + '-' + parte[1] + '-' + parte[2];
                return b;
            })
            if (lstBitacoras != null &amp;&amp; lstBitacoras != undefined) {
                if (lstBitacoras.resultados != null &amp;&amp; lstBitacoras.resultados != undefined &amp;&amp; lstBitacoras.resultados.length != 0) {
                    if(isSynced() == true || isSynced() == 'true') {
                        showNotice('Cargando la información, espere un momento');
                        guardarBitacoras(lstBitacoras.resultados, function (success) {
                            getBitacoraData();
                        });
                    } else {
                        getBitacoraData();
                    }
                } else {
                    bitacoraLog.debug('no se encontraron bitácoras relacionadas con el siniestro');
                    showNotice('No se encontraron bitácoras relacionadas con el siniestro');
                    getBitacoraData();
                }
            } else {
                bitacoraLog.debug('no se encontraron bitácoras relacionadas con el siniestro');
                showNotice('No se encontraron bitácoras relacionadas con el siniestro');
                getBitacoraData();
            }
        }, function (error) {
            bitacoraLog.debug('ocurrió un error al consultar las bitácoras', error);
            showError('Ocurrió un error al consultar las bitácoras');
            getBitacoraData();
        });
    } else {
        //Se consulta de la BD del celular
        getBitacoraData();
    }
}

/**
 * Función para guardar las bitácoras
 * @param {*} lstBitacoras 
 * @param {*} callback 
 */
function guardarBitacoras(lstBitacoras, callback) {
    var idSiniestro = window.localStorage.getItem("idSiniestroLocal");
    var caso_id = window.localStorage.getItem("idSiniestroServidor");
    var count = 0;
    BitacoraService.detectarYBorrarBitacorasEliminadasDelServidor(lstBitacoras).finally(() => {
        lstBitacoras.forEach(function (bitacora) {
            //consulta la informacion de la BD movil y hace la validacion de si ya existe
            sqlQuery('SELECT * FROM Bitacora WHERE id = ?', [bitacora.id], function (noExiste) {
                if (noExiste != true) {
                    bitacoraLog.debug('guardando bitacora nueva', bitacora);
                    //Si existe un registro entonces lo actualiza
                    sqlQuery('UPDATE Bitacora SET id = ?, fecha = ?, gestion = ?, subtarea = ?, tiempo = ?, usuario = ?, comentario = ? WHERE id = ?',
                        [bitacora.id, bitacora.fecha, bitacora.gestion, bitacora.subtarea, bitacora.tiempo, bitacora.usuario, bitacora.cometario, bitacora.id], 
                        function() {
                            if(lstBitacoras.length == (count+1)){
                                callback(true);
                            }
                        }
                    );
                } else {
                    bitacoraLog.debug('guardando bitacora existente', bitacora);
                    sqlQuery('INSERT INTO Bitacora (id, fecha, gestion, tiempo, comentario, usuario, subtarea, bitacora_caso , fk_idSiniestro) VALUES (?,?,?,?,?,?,?,?,?)',
                        [bitacora.id, bitacora.fecha, bitacora.gestion, bitacora.tiempo, bitacora.cometario, bitacora.usuario, bitacora.subtarea, caso_id, idSiniestro], 
                        function(last_id) {
                            if(lstBitacoras.length == (count+1)){
                                callback(true);
                            }
                        }
                    );
                }
                if ((count + 1) === lstBitacoras.length) {
                    callback(true);
                }
                count++;
            });
        });
    })
}

/**
 * Función que consulta el listado de bitácoras
 * en base al id del siniestro actual
 */
function getBitacoraData() {
    let numSin = window.localStorage.getItem("idSiniestroServidor"); //Numero de siniestro
    return sqlPromise(`SELECT b.*
        FROM Bitacora b
        WHERE bitacora_caso = ?
        ORDER BY case WHEN date(b.fecha) IS NOT NULL THEN date(b.fecha) ELSE date(b.fecha_orden) END ASC`, [numSin])
    .then(sqlResult => {
        return rowsAsList(sqlResult);
    }).then(listado => {
        resultadosBitacora(listado);
    })
}

/**
 * Función para procesar los datos del
 * siniestro
 * @param {Array&lt;Bitacora>} bitacoras
 */
function resultadosBitacora(bitacoras) {
    var fechaActual = obtenerFechaHHMMSS(new Date());
    var html = '';
    var titleApp = window.localStorage.getItem("titleApp");
    $('#titleApp').html(titleApp);
    if (bitacoras != null) {
        html += '&lt;table class="table tableKronos table-striped table-sm shadow-sm m-0">';
        //Encabezado de tabla
        html += '&lt;thead>' +
            '&lt;tr>' +
            '&lt;th>Fecha&lt;/th>' +
            '&lt;th>Tarea&lt;/th>' +
            '&lt;th>Tiempo&lt;/th>' +
            '&lt;th>Usuario&lt;/th>' +
            '&lt;/tr>' +
            '&lt;/thead>';
        //Elementos de la tabla
        html += '&lt;tbody>';
        var count = 0;
        var tipoBitacora = null;
        var perfilUsuario = window.localStorage.getItem("perfilUsuario");
        bitacoras.forEach(function (bitacora) {
            sqlQuery('SELECT bita_accion_id FROM CatalogoTarea WHERE bita_accion_tex = ? AND bita_accion_facturable = ?', [bitacora.gestion, 'Facturable'], function (noFacturable) {
                if (noFacturable != true) { //Solo muestra las bitácoras facturables
                    tipoBitacora = "Facturable"; //Guarda el tipo de bitacora
                    if (perfilUsuario == "Administrador") { //Usuario con perfil administrador
                        html += '&lt;tr onclick="verBitacora(' + bitacora.idBitacora + ');">' +
                            '&lt;td style="color:#FE8416;">' + fn.formatDate(bitacora.fecha) + '&lt;/td>' +
                            '&lt;td>' + bitacora.gestion + '&lt;/td>' +
                            '&lt;td>' + bitacora.tiempo + '&lt;/td>' +
                            '&lt;td>' + bitacora.usuario + '&lt;/td>' +
                            '&lt;/tr>';
                    } else { //Usuarios sin perfil administrador
                        //Fechas a objetos Moment
                        var mFechaActual = moment(fechaActual);
                        var mFecha_orden = moment(bitacora.fecha_orden);
                        //Se obtiene la diferencia de cada fecha
                        var validDay = moment.duration(mFechaActual.diff(mFecha_orden, 'days'));
                        var validTime = moment.duration(mFechaActual.diff(mFecha_orden, 'hours'));
                        //Se valida que el día sea el mismo
                        if (validDay == 0 || validDay == "0") {
                            //Se válida que la diferencia de horas sea menor a 2hrs.
                            if (validTime &lt; 2) {
                                html += '&lt;tr onclick="verBitacora(' + bitacora.idBitacora + ');">' +
                                    '&lt;td style="color:#FE8416;">' + fn.formatDate(bitacora.fecha) + '&lt;/td>' +
                                    '&lt;td>' + bitacora.gestion + '&lt;/td>' +
                                    '&lt;td>' + bitacora.tiempo + '&lt;/td>' +
                                    '&lt;td>' + bitacora.usuario + '&lt;/td>' +
                                    '&lt;/tr>';
                            } else {
                                html += '&lt;tr>' +
                                    '&lt;td style="color:#0081BD;">' + fn.formatDate(bitacora.fecha) + '&lt;/td>' +
                                    '&lt;td>' + bitacora.gestion + '&lt;/td>' +
                                    '&lt;td>' + bitacora.tiempo + '&lt;/td>' +
                                    '&lt;td>' + bitacora.usuario + '&lt;/td>' +
                                    '&lt;/tr>';
                            }
                        } else {
                            html += '&lt;tr>' +
                                '&lt;td style="color:#0081BD;">' + fn.formatDate(bitacora.fecha) + '&lt;/td>' +
                                '&lt;td>' + bitacora.gestion + '&lt;/td>' +
                                '&lt;td>' + bitacora.tiempo + '&lt;/td>' +
                                '&lt;td>' + bitacora.usuario + '&lt;/td>' +
                                '&lt;/tr>';
                        }
                    }
                } else if (bitacora.subtarea != 'Non Authorized Time') {
                    tipoBitacora = "No Facturable"; //Guarda el tipo de bitacora
                    if (perfilUsuario == 'Administrador') { //Puede editar las bitacoras no facturables
                        html += '&lt;tr onclick="verBitacoraNoFact(' + bitacora.idBitacora + ');">' +
                            '&lt;td style="color:#FE8416;">' + fn.formatDate(bitacora.fecha) + '&lt;/td>' +
                            '&lt;td>' + bitacora.gestion + '&lt;/td>' +
                            '&lt;td>' + bitacora.tiempo + '&lt;/td>' +
                            '&lt;td>' + bitacora.usuario + '&lt;/td>' +
                            '&lt;/tr>';
                    } else {
                        html += '&lt;tr>' +
                            '&lt;td style="color:#0081BD;">' + fn.formatDate(bitacora.fecha) + '&lt;/td>' +
                            '&lt;td>' + bitacora.gestion + '&lt;/td>' +
                            '&lt;td>' + bitacora.tiempo + '&lt;/td>' +
                            '&lt;td>' + bitacora.usuario + '&lt;/td>' +
                            '&lt;/tr>';
                    }
                }
                if (bitacoras.length == (count + 1)) {
                    html += '&lt;/tbody>';
                    html += '&lt;/table>';
                    $('#resultadoBitacora').html(html);
                }
                count++;
            });
        });
    } else { //SI no hay bitácoras relacionadas
        html += '&lt;h4>No se encontraron resultados&lt;/h4>';
        $('#resultadoBitacora').html(html);
    }
}

/* *
 * Funcion que inicializa la pantalla de
 * nueva bitacora facturable
 */
function nuevaBitacoraFacturable() {
    var numCaso = window.localStorage.getItem("idSiniestroServidor");
    numCaso = numCaso != null &amp;&amp; numCaso != undefined ?
        numCaso : window.localStorage.getItem("idSiniestroLocal");
    sqlQuery('SELECT * FROM Siniestro WHERE caso_id = ?', [numCaso],
        function (datosSiniestro) {
            if (datosSiniestro != true) {
                var estado_real = datosSiniestro[0].estado;
                if (estado_real === "Finalizado") {
                    showNotice('El caso actual se encuentra finalizado, '
                            +   'no se pueden agregar más bitácoras facturables');
                } else {
                    fn.load('bitFacturable.html');
                    initBitacora('Facturable');
                }
            } else {
                showNotice("No se encontró información del siniestro, intente nuevamente");
            }
        }
    );
}

/**
 * Función que inicializa la pantalla
 * de bitacora no facturable
 */
function nuevaBitacoraNoFacturable() {
    fn.load('bitNoFacturable.html');
    initBitacora("No Facturable");
}

/**
 * Inicializa los datos
 * generales de la pantalla
 * para capturar una nueva bitácora
 */
function initBitacora(tipoBitacora) {
    //Se consultan los datos del usuario logeado
    sqlQuery('SELECT * FROM DatosUsuario', null, function (datos) {
        if (datos != true) {
            $('#usuario_caso').val(datos[0].user_nombre);
        }
        var titleApp = window.localStorage.getItem("titleApp");
        $('#titleApp').html(titleApp);
        $('#comentario').val('');
        document.getElementById('fecha').value = obtenerFecha(new Date());
        validacionNuevaBitacora(); // Se valida el formulario de nueva bitacora
    });

    //Carga el select de tareas
    sqlQuery('SELECT * FROM CatalogoTarea WHERE bita_accion_facturable = ? ORDER BY bita_accion_tex ASC', [tipoBitacora], function (tareas) {
        showLoading();
        if (tareas != true) {
            var selectTareas = '';
            selectTareas += '&lt;ons-select id="select_tareas" name="select_tareas" onchange="loadSubtareas();" required>';
            selectTareas += '&lt;option value="">Seleccione una opción...&lt;/option>';
            tareas.forEach(function (tarea) {
                selectTareas += '&lt;option value="' + tarea.bita_accion_id + '" >' + tarea.bita_accion_tex + '&lt;/option>';
            });
            selectTareas += '&lt;/ons-select>';
            $('#bita_tareas').html(selectTareas);
            if (tipoBitacora === 'Facturable') {
                var caso_id = window.localStorage.getItem("idSiniestroServidor");
                $('#caso_id').val(caso_id);
            } else if (tipoBitacora === 'No Facturable') {
                $('#caso_id').val(0);
            }
        }
        hideLoading();
    });
}

/**
 * Función para ver una bitácora ya creada
 * @param {*} idBitacora 
 */
function verBitacora(idBitacora) {
    bitacoraLog.debug('consultando bitacora con id:', idBitacora);
    window.localStorage.setItem("idBitacoraLocal", idBitacora); //Inicio sesión
    fn.load('bitFacturable.html');
    loadBitacora(idBitacora, "Facturable");
}

function verBitacoraNoFact(idBitacora) {
    bitacoraLog.debug('consultando bitacora con id:', idBitacora);
    window.localStorage.setItem("idBitacoraLocal", idBitacora); //Inicio sesión
    fn.load('bitFacturable.html');
    loadBitacora(idBitacora, "No Facturable");
}

/**
 * Carga la información de una bitácora 
 * facturable ya creada
 * @param {*} idBitacora 
 */
function loadBitacora(idBitacora, tipoBitacora) {
    sqlQuery('SELECT * FROM Bitacora WHERE idBitacora = ?', [idBitacora], function (bitacoraData) {
        if (bitacoraData != true) {
            var bitacora = bitacoraData[0];
            $('#bitacora_id').val(bitacora.id);
            $('#idBitacora').val(bitacora.idBitacora);
            $('#caso_id').val(bitacora.bitacora_caso);
            sqlQuery('SELECT * FROM CatalogoTarea WHERE bita_accion_facturable = ?', [tipoBitacora], function (tareas) {
                if (tareas != true) {
                    var selectTareas = '';
                    selectTareas += '&lt;ons-select id="select_tareas" name="select_tareas" onchange="loadSubtareas();" required>';
                    selectTareas += '&lt;option value="">Seleccione una opción...&lt;/option>';
                    tareas.forEach(function (tarea) {
                        if (tarea.bita_accion_tex == bitacora.gestion) {
                            selectTareas += '&lt;option value="' + tarea.bita_accion_id + '" selected>' + tarea.bita_accion_tex + '&lt;/option>';
                        } else {
                            selectTareas += '&lt;option value="' + tarea.bita_accion_id + '" >' + tarea.bita_accion_tex + '&lt;/option>';
                        }
                    });
                    selectTareas += '&lt;/ons-select>';
                    $('#bita_tareas').html(selectTareas);
                    loadSubtareas(bitacora.subtarea);
                }
            });
            sqlQuery('SELECT * FROM DatosUsuario', null, function (datos) {
                var perfilUsuario = null;
                if (datos != true) {
                    $('#usuario_caso').val(datos[0].user_nombre);
                    perfilUsuario = datos[0].tipo_user_nombre;
                }
                // correccion en fecha de bitacoras
                // el servidor guarda las fechas en formato 2020-1-3
                // pero la aplicacion requiere el formato 2020-01-03
                let anio = bitacora.fecha.split('-')[0]
                let mes = bitacora.fecha.split('-')[1]
                let dia = bitacora.fecha.split('-')[2]
                let fechaCorrecta = anio + '-' + mes.padStart(2,0) + '-' + dia.padStart(2,0);
                var titleApp = window.localStorage.getItem("titleApp");
                $('#titleApp').html(titleApp);
                $('#comentario').val(bitacora.comentario);
                $('#fecha').val(fechaCorrecta);
                $('#tiempo').val(bitacora.tiempo);
                optionBitaFact('edita', perfilUsuario);
            });
        }
    });
}

/**
 * Función que se utiliza para 
 * mostrar las opciones de una bitácora
 * facturable ya creada
 * @param {*} accion 
 */
function optionBitaFact(accion, perfil) {
    var html = '';
    if (accion == 'edita') {
        //Botón eliminar
        html += 
            '&lt;ons-button modifier="quiet" style="background-color:#D8DADB;color: #0081BD;" ' +
            'class="center shadow-sm" onclick="deleteBitacora();">' +
            '&lt;ons-icon icon="md-delete" style="color: #FE8416;font-size:18px;">&lt;/ons-icon>' +
            '  Eliminar' +
            '&lt;/ons-button>&amp;nbsp;';
        //Botón Guardar Cambios
        html += 
            '&lt;ons-button id="btnActualizarBitacora" modifier="quiet" style="background-color:#D8DADB;color: #0081BD;"' +
            'onclick="updateBitacora();">' +
            '&lt;ons-icon icon="md-card-sd" style="color: #FE8416;font-size:18px;">&lt;/ons-icon>' +
            '  Guardar Cambios' +
            '&lt;/ons-button>';
        //Transferir a tarea no facturable
        if (perfil != undefined) {
            if (perfil != null &amp;&amp; perfil == "Administrador") {
                html += '&lt;ons-button modifier="quiet" style="background-color:#D8DADB;color:#0081BD;" ' +
                    'onclick="cambiarTareaNoFact();" >' +
                    '&lt;ons-icon icon="md-shuffle" style="color: #FE8416;font-size:18px;">&lt;/ons-icon>' +
                    ' Cambiar a Tarea No Facturable' +
                    '&lt;/ons-button>'
            }
        }
        $('#bitaOptions').html(html);
    }
}

/**
 * Función que cambia el select 
 * de subtareas
 */
function loadSubtareas(bitaSubtarea) {
    var idTarea = $('#select_tareas').val();
    sqlQuery('SELECT * FROM CatalogoSubtarea WHERE bita_objetivo_accion = ? ORDER BY bita_objetivo_text ASC', [idTarea], function (subtareas) {
        showLoading();
        if (subtareas != true) {
            var selectSubtareas = '';
            selectSubtareas += '&lt;ons-select id="select_subtareas" name="select_subtareas" required>';
            selectSubtareas += '&lt;option value="">Seleccione una opción...&lt;/option>';
            subtareas.forEach(function (subtarea) {
                if (subtarea.bita_objetivo_text == bitaSubtarea) {
                    selectSubtareas += '&lt;option value="' + subtarea.bita_objetivo_id + '" selected>' + subtarea.bita_objetivo_text + '&lt;/option>';
                } else {
                    selectSubtareas += '&lt;option value="' + subtarea.bita_objetivo_id + '" >' + subtarea.bita_objetivo_text + '&lt;/option>';
                }
            });
            selectSubtareas += '&lt;/ons-select>';
            $('#bita_subtarea').html(selectSubtareas);
        }
        hideLoading();
    });
}

/**
 * Función para actualizar los datos de
 * una bitácora
 */
function updateBitacora() {
    document.getElementById('btnActualizarBitacora').setAttribute('disabled', 'disabled');
    document.getElementById('btnActualizarBitacora').insertAdjacentHTML('beforeend', `&lt;span class="spinner-grow spinner-grow-sm" role="status" aria-hidden="true" style="margin-bottom: 2px;">&lt;/span>`)
    var updateBitacora = 'UPDATE Bitacora SET id = ?, ' +
        'fecha_orden = ?, ' +
        'fecha = ?, ' +
        'gestion = ?, ' +
        'tiempo = ?, ' +
        'comentario = ?, ' +
        'usuario = ?, ' +
        'subtarea = ?, ' +
        'bitacora_caso = ?, ' +
        'fk_idSiniestro = ?, ' +
        'bitacora_observacion = ?, ' +
        'anio = ?, ' +
        'mes = ?, ' +
        'dia = ?, ' +
        'bitacora_accion = ?, ' +
        'objetivo = ?, ' +
        'bitacora_tiempo = ? WHERE idBitacora = ?';

    var idTarea = $('#select_tareas').val();
    var idSubtarea = $('#select_subtareas').val();
    var idBitacora = $('#idBitacora').val();
    var gestion;
    var subtarea;

    //Se obtiene la tarea en base al id
    sqlQuery('SELECT * FROM CatalogoTarea WHERE bita_accion_id = ?', [idTarea], function (tareas) {
        if (tareas != true) {
            gestion = {
                tarea_id: idTarea,
                tarea_tex: tareas[0].bita_accion_tex
            };
            //Se obtiene la subtarea en base al id
            sqlQuery('SELECT * FROM CatalogoSubtarea WHERE bita_objetivo_accion = ? AND bita_objetivo_id = ? LIMIT 1', [idTarea, idSubtarea], function (subtareas) {
                if (subtareas != true) {
                    subtarea = {
                        subtarea_id: idSubtarea,
                        subtarea_tex: subtareas[0].bita_objetivo_text
                    };
                    //Se obtienen los datos del usuario actual
                    sqlQuery('SELECT * FROM DatosUsuario', null, function (datosUser) {
                        if (datosUser != true) {
                            var bitacoraParams = getBitacoraParams(gestion, subtarea, datosUser[0].user_iniciales); //Se genera el objeto JSON de bitacora
                            var params = fn.JsonToArray(bitacoraParams);
                            params.push(idBitacora);
                            sqlQuery(updateBitacora, params, function (success) {
                                showSuccess('Se han guardado los cambios');
                                if (bitacoraParams.id != null) {
                                    sendCambiosBitacora(bitacoraParams);
                                } else {
                                    bitacora();
                                }
                            });
                        } else {
                            showNotice("No se obtuvo la información del ajustador actual");
                        }
                    });
                } else {
                    showNotice("No se encontró la subtarea seleccionada");
                }
            });
        } else {
            showNotice("No se encontró la tarea seleccionada");
        }
    });
}

/**
 * Función que envia o almacena la petición para
 * cambiar o modificar los datos de una
 * bitácora
 * @param {*} bitacoraParams 
 */
function sendCambiosBitacora(bitacoraParams) {
    var tipo_oper = 'UPD';
    var idSiniestro = window.localStorage.getItem("idSiniestroServidor");
    var bitacora_id = $('#bitacora_id').val();
    var params = {
        filt_caso: idSiniestro,
        tipo_oper: tipo_oper,
        bitacora_observacion: bitacoraParams.comentario,
        bitacora_id: bitacora_id,
        bitacora_accion: bitacoraParams.bitacora_accion,
        objetivo: bitacoraParams.objetivo,
        anio: bitacoraParams.anio,
        mes: bitacoraParams.mes,
        dia: bitacoraParams.dia,
        bitacora_tiempo: bitacoraParams.bitacora_tiempo
    }

    sqlQuery('INSERT INTO CambioBitacora (filt_caso, ' +
            'tipo_oper, ' +
            'bitacora_observacion, ' +
            'bitacora_id, ' +
            'bitacora_accion, ' +
            'objetivo, ' +
            'anio, ' +
            'mes, ' +
            'dia, ' +
            'bitacora_tiempo) VALUES (?,?,?,?,?,?,?,?,?,?)', fn.JsonToArray(params),
            function (last_id) {
                guardarPeticion('siniestro_bitacora.php', 'put', 'CambioBitacora', 'idCambioBitacora', last_id);
                showSuccess('Se ha guardado el cambio de bitacora con éxito');
                bitacora();
                if(verificarConexion() == true) {
                    syncLocalData('sync');
                }
            }, true);
}

/**
 * Función para eliminar una bitácora
 */
function deleteBitacora() {
    var bitacora_id = $('#bitacora_id').val();
    var idBitacora = $('#idBitacora').val();
    bitacoraLog.debug('borrando bitacora con id', idBitacora)
    sqlQuery('SELECT * FROM Bitacora WHERE idBitacora = ?', [idBitacora], function (bitacoraData) {
        if (bitacoraData != true) {
            sqlQuery('DELETE FROM Bitacora WHERE idBitacora = ?', [idBitacora], function (success) {
                if (success) {
                    if (bitacoraData[0].id != null) {
                        sqlQuery('INSERT INTO BitacoraEliminar(bitacora_id) VALUES (?)', [bitacora_id], function (last_id_bitEliminar) {
                            bitacora();
                            if (last_id_bitEliminar) {
                                showSuccess('Se ha eliminado la bitácora ' + bitacora_id);
                                var urlController = 'siniestro_bitacora.php?bitacora_id=' + bitacora_id;
                                guardarPeticion(urlController, 'DELETE', 'BitacoraEliminar', 'idBitacoraEliminar', last_id_bitEliminar, function(success){
                                    if(verificarConexion() == true) {
                                        syncLocalData('sync');
                                    }
                                });
                            }
                        }, true);
                    } else {
                        deletePeticion('Bitacora', 'idBitacora', bitacoraData[0].idBitacora, 'PEND', function (success) {
                            showSuccess('Se ha eliminado la bitácora ' + idBitacora);
                            bitacora();
                        });
                    }
                } else {
                    showError('Ocurrió un error al eliminar la bitácora ' + bitacora_id);
                }
            });
        } else {
            showError('No se pudo obtener la bitácora');
        }
    });
}

/**
 * Función para cambiar la tarea de una 
 * bitacora a NO Facturable
 */
function cambiarTareaNoFact() {
    var tipo_oper = 'NOFACT';
    var detalle = $('#comentario').val();;
    var bitacora_id = $('#bitacora_id').val();
    if (bitacora_id.trim() === "") {
        bitacora_id = null;
    }
    var idBitacora = $('#idBitacora').val();
    var idSiniestro = window.localStorage.getItem("idSiniestroServidor");
    bitacoraLog.debug('cambiando la tarea a no facturable', {bitacora_id, idBitacora, idSiniestro});
    var params = {
        filt_caso: idSiniestro,
        tipo_oper: tipo_oper,
        bitacora_observacion: detalle,
        bitacora_id: bitacora_id
    }
    sqlQuery('SELECT * FROM Bitacora WHERE idBitacora = ?', [idBitacora], function (bitacoraData) {
        if (bitacoraData != true) {
            var coment_original = bitacoraData[0].comentario;
            coment_original = coment_original ? coment_original : '';
            if (coment_original.trim() === detalle.trim()) {
                showError('Capture motivo de cambio a No Facturable');
            } else {
                if (params.bitacora_id != null) {
                    if (verificarConexion() == true) {
                        sendRequest('put', 'siniestro_bitacora.php', params, function (response) {
                            if (response.resultados) {
                                response.resultados.forEach(function (bitacora) {
                                    sqlQuery('UPDATE Bitacora SET fecha_orden = ?, fecha = ?, gestion = ?, tiempo = ?, comentario = ?, usuario = ?, subtarea = ? WHERE id = ?',
                                        [bitacora.fecha_orden, bitacora.fecha, bitacora.gestion, bitacora.tiempo, bitacora.cometario, bitacora.usuario, bitacora.subtarea, bitacora.id],
                                        function (success) {
                                            showSuccess('Se ha guardado el cambio de bitacora con éxito');
                                            hideLoading();
                                        });
                                });
                            }
                            showLoading();
                            bitacora();
                        }, function (error) {
                            guardarCambioBitacora(idBitacora, params);
                        })
                    } else {
                        guardarCambioBitacora(idBitacora, params);
                    }
                } else {
                    guardarCambioBitacora(idBitacora, params);
                }
            }
        } else {
            guardarCambioBitacora(idBitacora, params);
        }
    });
}

/**
 * Función para actualizar una bitacora a 
 * no facturable en la base de datos
 * local
 * @param {*} idBitacora 
 */
function updateBitaNoFact(idBitacora) {
    sqlQuery('SELECT * FROM CatalogoTarea WHERE bita_accion_id = ?', [2], function (tareaData) {
        if (tareaData != true) {
            sqlQuery('SELECT * FROM CatalogoSubtarea WHERE bita_objetivo_accion = ? AND bita_objetivo_id = ?', [2, 75], function (subtareaData) {
                sqlQuery('UPDATE Bitacora SET gestion = ?, subtarea = ? WHERE idBitacora = ?',
                    [tareaData[0].bita_accion_tex, subtareaData[0].bita_objetivo_text, idBitacora],
                    function (success) {
                        bitacora();
                        showSuccess('Se ha cambiado la bitácora a tarea no facturable');
                    });
            });
        }
    });
}

/**
 * Función para guardar los cambios de una
 * bitacora facturable a una no
 * facturable
 * @param {*} idBitacora 
 * @param {*} params 
 */
function guardarCambioBitacora(idBitacora, params) {
    var arrayParams = fn.JsonToArray(params);
    arrayParams.push(idBitacora);
    sqlQuery('INSERT INTO CambioBitacora (filt_caso, tipo_oper, bitacora_observacion, bitacora_id, fk_idBitacora) VALUES (?,?,?,?,?)',
        arrayParams,
        function (last_id) {
            guardarPeticion('siniestro_bitacora.php', 'put', 'CambioBitacora', 'idCambioBitacora', last_id);
            updateBitaNoFact(idBitacora);
        }, true);
}

/**
 * Guarda una bitacora facturable y 
 * regresa a la pantalla de bitácoras
 */
function guardarBitacoraFacturableYSalir() {
    isFacturable = true;
    salir = true;
    $('#nuevaBitacoraFact').submit();
}

/**
 * Guarda una bitacora facturable y 
 * prepara la pantalla para capturar una 
 * nueva bitácora
 */
function guardarBitacoraFacturableYNueva() {
    isFacturable = true;
    salir = false;
    $('#nuevaBitacoraFact').submit();
}

/**
 * Guarda una bitacora no facturable y
 * regresa al listado de bitácoras
 */
function guardarBitacoraNoFacturableYSalir() {
    isFacturable = false;
    salir = true;
    $('#nuevaBitacoraFact').submit();
}

/**
 * Guarda una bitacora no facturable y prepara 
 * la pantalla para capturar una nueva bitácora
 */
function guardarBitacoraNoFacturableYNueva() {
    isFacturable = false;
    salir = false;
    $('#nuevaBitacoraFact').submit();
}

/**
 * Función que inserta una nueva
 * bitácora en la base de datos
 */
function guardarBitacora(url, callback, salir) {
    let botonCrearYSalir = document.getElementById('btnCrearYSalirBitacora');
    let botonCrearYNuevo = document.getElementById('btnCrearYNuevoBitacora');
    botonCrearYSalir.setAttribute('disabled', 'disabled');
    botonCrearYNuevo.setAttribute('disabled', 'disabled');
    if (salir)
        botonCrearYSalir.insertAdjacentHTML('beforeend', `&lt;span class="spinner-grow spinner-grow-sm" role="status" aria-hidden="true">&lt;/span>`);
    else
        botonCrearYNuevo.insertAdjacentHTML('beforeend', `&lt;span class="spinner-grow spinner-grow-sm" role="status" aria-hidden="true">&lt;/span>`)
    var query = 'INSERT INTO Bitacora (id, ' +
        'fecha_orden, ' +
        'fecha, ' +
        'gestion, ' +
        'tiempo, ' +
        'comentario, ' +
        'usuario, ' +
        'subtarea, ' +
        'bitacora_caso, ' +
        'fk_idSiniestro, ' +
        'bitacora_observacion, ' +
        'anio, ' +
        'mes, ' +
        'dia, ' +
        'bitacora_accion, ' +
        'objetivo, ' +
        'bitacora_tiempo) VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)';

    var idTarea = $('#select_tareas').val();
    var idSubtarea = $('#select_subtareas').val();
    var gestion;
    var subtarea;

    //Se obtiene la tarea en base al id
    sqlQuery('SELECT * FROM CatalogoTarea WHERE bita_accion_id = ?', [idTarea], function (tareas) {
        if (tareas != true) {
            gestion = {
                tarea_id: idTarea,
                tarea_tex: tareas[0].bita_accion_tex
            };
            //Se obtiene la subtarea en base al id
            sqlQuery('SELECT * FROM CatalogoSubtarea WHERE bita_objetivo_accion = ? AND bita_objetivo_id = ? LIMIT 1', [idTarea, idSubtarea], function (subtareas) {
                if (subtareas != true) {
                    subtarea = {
                        subtarea_id: idSubtarea,
                        subtarea_tex: subtareas[0].bita_objetivo_text
                    };
                    //Se obtienen los datos del usuario actual
                    sqlQuery('SELECT * FROM DatosUsuario', null, function (datosUser) {
                        if (datosUser != true) {
                            var bitacora = getBitacoraParams(gestion, subtarea, datosUser[0].user_iniciales); //Se genera el objeto JSON de bitacora
                            //Se guarda la nueva bitacora
                            sqlQuery(query, fn.JsonToArray(bitacora), function (last_id) {
                                //Se guarda la peticion del post
                                guardarPeticion(url, 'POST', 'Bitacora', 'idBitacora', last_id, function (saved) {
                                    if (saved) {
                                        callback(true);
                                    }
                                });
                            }, true);
                        } else {
                            showNotice("No se obtuvo la información del ajustador actual");
                        }
                    });
                } else {
                    showNotice("No se encontró la subtarea seleccionada");
                }
            });
        } else {
            showNotice("No se encontró la tarea seleccionada");
        }
    });
}

/**
 * Función que obtiene los datos para agregar
 * una nueva bitácora del siniestro
 * @param {*} gestion 
 * @param {*} subtarea 
 * @param {*} user_iniciales 
 */
function getBitacoraParams(gestion, subtarea, user_iniciales) {
    var idSiniestro = window.localStorage.getItem("idSiniestroLocal");
    var caso_id = $('#caso_id').val();
    /* var caso_id = window.localStorage.getItem("idSiniestroServidor"); */
    var fecha = $('#fecha').val();
    var tiempo = $('#tiempo').val();
    var comentario = $('#comentario').val();
    var fechaActual = obtenerFechaHHMMSS(new Date());
    var bitacora_id = $('#bitacora_id').val();

    var bitacora = {
        id: bitacora_id ? bitacora_id : null,
        fecha_orden: fechaActual ? fechaActual : null,
        fecha: fecha ? fecha : null,
        gestion: gestion.tarea_tex ? gestion.tarea_tex : "No especificada",
        tiempo: tiempo ? tiempo : null,
        comentario: comentario ? comentario : null,
        usuario: user_iniciales ? user_iniciales : null,
        subtarea: subtarea.subtarea_tex ? subtarea.subtarea_tex : "No especificada",
        bitacora_caso: caso_id ? caso_id : null,
        fk_idSiniestro: idSiniestro ? idSiniestro : null,
        bitacora_observacion: comentario ? comentario : null,
        anio: fecha.split("-")[0] ? fecha.split("-")[0] : null,
        mes: fecha.split("-")[1] ? fecha.split("-")[1] : null,
        dia: fecha.split("-")[2] ? fecha.split("-")[2] : null,
        bitacora_accion: gestion.tarea_id ? gestion.tarea_id : null,
        objetivo: subtarea.subtarea_id ? subtarea.subtarea_id : null,
        bitacora_tiempo: tiempo ? tiempo : null
    }
    return bitacora;
}

/**
 * Limpia los campos del formulario
 */
function limpiarCampos() {
    $('#bitacora_tarea').val("");
    $('#bitacora_subtarea').val("");
    $('#usuario_caso').val('');
    $('#fecha').val('');
    $('#comentario').val('');
    $('#tiempo').val('');
}

/**
 * Función que válida el formulario de 
 * bitácora
 */
function validacionNuevaBitacora() {
    $('#nuevaBitacoraFact').validate({
        errorClass: "errorForm",
        validClass: "validForm",
        submitHandler: function () {
            if (isFacturable == true) {
                guardarBitacora('siniestro_bitacora.php', function (result) {
                    if (result == true) {
                        showSuccess('Se ha guardado la bitácora correctamente');
                        limpiarCampos();
                        if (salir == true) {
                            bitacora();
                        } else if (salir == false) {
                            nuevaBitacoraFacturable();
                        }
                    } else {
                        showNotice('Ocurrió un error al guardar la bitácora');
                    }
                }, salir);
            } else {
                guardarBitacora('siniestro_bitacora.php', function (result) {
                    if (result == true) {
                        showSuccess('Se ha guardado la bitácora correctamente');
                        limpiarCampos();
                        if (salir == true) {
                            bitacora();
                        } else if (salir == false) {
                            nuevaBitacoraNoFacturable();
                        }
                    } else {
                        showNotice('Ocurrió un error al guardar la bitácora');
                    }
                }, salir);
            }
        },
        invalidHandler: function (event, validator) {
            if (validator.numberOfInvalids()) {
                showError("Revisa los campos marcados");
            }
        }
    });
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-GestureDetector.html">GestureDetector</a></li><li><a href="module-gestures.html">gestures</a></li></ul><h3>Classes</h3><ul><li><a href="-_anonymous_-GestureDetector.Instance.html">Instance</a></li><li><a href="CatalogoService.html">CatalogoService</a></li><li><a href="DialogoCerrarSesion.html">DialogoCerrarSesion</a></li><li><a href="DialogoNuevoUsuario.html">DialogoNuevoUsuario</a></li><li><a href="DialogoRestablecer.html">DialogoRestablecer</a></li><li><a href="GastosService.html">GastosService</a></li><li><a href="InspeccionFotografia.html">InspeccionFotografia</a></li><li><a href="InspeccionSubirDocumento.html">InspeccionSubirDocumento</a></li><li><a href="InspeccionTablaFotografias.html">InspeccionTablaFotografias</a></li><li><a href="ListadoPeticiones.html">ListadoPeticiones</a></li><li><a href="module-GestureDetector.Detection.html">Detection</a></li><li><a href="module-GestureDetector.Event.html">Event</a></li><li><a href="module-GestureDetector.PointerEvent.html">PointerEvent</a></li><li><a href="module-gestures.Drag.html">Drag</a></li><li><a href="module-gestures.Gesture.html">Gesture</a></li><li><a href="module-gestures.Hold.html">Hold</a></li><li><a href="module-gestures.Release.html">Release</a></li><li><a href="module-gestures.Swipe.html">Swipe</a></li><li><a href="module-gestures.Tap.html">Tap</a></li><li><a href="module-gestures.Touch.html">Touch</a></li><li><a href="module-gestures.Transform.html">Transform</a></li><li><a href="PeticionesDao.html">PeticionesDao</a></li><li><a href="TablaDetalleGasto.html">TablaDetalleGasto</a></li><li><a href="Utils.html">Utils</a></li></ul><h3>Events</h3><ul><li><a href="module-gestures.html#~event:change">change</a></li><li><a href="module-gestures.html#~event:changestate">changestate</a></li><li><a href="module-gestures.html#~event:close">close</a></li><li><a href="module-gestures.html#~event:destroy">destroy</a></li><li><a href="module-gestures.html#~event:doubletap">doubletap</a></li><li><a href="module-gestures.html#~event:drag">drag</a></li><li><a href="module-gestures.html#~event:dragdown">dragdown</a></li><li><a href="module-gestures.html#~event:dragend">dragend</a></li><li><a href="module-gestures.html#~event:dragright">dragright</a></li><li><a href="module-gestures.html#~event:dragstart">dragstart</a></li><li><a href="module-gestures.html#~event:dragup">dragup</a></li><li><a href="module-gestures.html#~event:drapleft">drapleft</a></li><li><a href="module-gestures.html#~event:gesture">gesture</a></li><li><a href="module-gestures.html#~event:hide">hide</a></li><li><a href="module-gestures.html#~event:hold">hold</a></li><li><a href="module-gestures.html#~event:init">init</a></li><li><a href="module-gestures.html#~event:modechange">modechange</a></li><li><a href="module-gestures.html#~event:open">open</a></li><li><a href="module-gestures.html#~event:overscroll">overscroll</a></li><li><a href="module-gestures.html#~event:pinchin">pinchin</a></li><li><a href="module-gestures.html#~event:pinchout">pinchout</a></li><li><a href="module-gestures.html#~event:postchange">postchange</a></li><li><a href="module-gestures.html#~event:postclose">postclose</a></li><li><a href="module-gestures.html#~event:posthide">posthide</a></li><li><a href="module-gestures.html#~event:postopen">postopen</a></li><li><a href="module-gestures.html#~event:postpop">postpop</a></li><li><a href="module-gestures.html#~event:postpush">postpush</a></li><li><a href="module-gestures.html#~event:postshow">postshow</a></li><li><a href="module-gestures.html#~event:prechange">prechange</a></li><li><a href="module-gestures.html#~event:preclose">preclose</a></li><li><a href="module-gestures.html#~event:prehide">prehide</a></li><li><a href="module-gestures.html#~event:preopen">preopen</a></li><li><a href="module-gestures.html#~event:prepop">prepop</a></li><li><a href="module-gestures.html#~event:prepush">prepush</a></li><li><a href="module-gestures.html#~event:preshow">preshow</a></li><li><a href="module-gestures.html#~event:reactive">reactive</a></li><li><a href="module-gestures.html#~event:refresh">refresh</a></li><li><a href="module-gestures.html#~event:release">release</a></li><li><a href="module-gestures.html#~event:rotate">rotate</a></li><li><a href="module-gestures.html#~event:show">show</a></li><li><a href="module-gestures.html#~event:swipe">swipe</a></li><li><a href="module-gestures.html#~event:swipedown">swipedown</a></li><li><a href="module-gestures.html#~event:swipeleft">swipeleft</a></li><li><a href="module-gestures.html#~event:swiperight">swiperight</a></li><li><a href="module-gestures.html#~event:swipeup">swipeup</a></li><li><a href="module-gestures.html#~event:tap">tap</a></li><li><a href="module-gestures.html#~event:touch">touch</a></li><li><a href="module-gestures.html#~event:transform">transform</a></li><li><a href="module-gestures.html#~event:transformend">transformend</a></li><li><a href="module-gestures.html#~event:transformstart">transformstart</a></li></ul><h3>Global</h3><ul><li><a href="global.html#abrirDocumentoConAplicacionDeTerceros">abrirDocumentoConAplicacionDeTerceros</a></li><li><a href="global.html#abrirNuevaInspeccion">abrirNuevaInspeccion</a></li><li><a href="global.html#actualizarEstatusPeticion">actualizarEstatusPeticion</a></li><li><a href="global.html#actualizarListadoGasto">actualizarListadoGasto</a></li><li><a href="global.html#appLog">appLog</a></li><li><a href="global.html#b64toBlob">b64toBlob</a></li><li><a href="global.html#backReporteGasto">backReporteGasto</a></li><li><a href="global.html#backVerInspeccion">backVerInspeccion</a></li><li><a href="global.html#baseDatosLog">baseDatosLog</a></li><li><a href="global.html#bitacora">bitacora</a></li><li><a href="global.html#buscarInspeccionSinSiniestro">buscarInspeccionSinSiniestro</a></li><li><a href="global.html#buscarReferencia">buscarReferencia</a></li><li><a href="global.html#buscarSiniestro">buscarSiniestro</a></li><li><a href="global.html#cambiarSiniestro">cambiarSiniestro</a></li><li><a href="global.html#cambiarTareaNoFact">cambiarTareaNoFact</a></li><li><a href="global.html#cargarSelect">cargarSelect</a></li><li><a href="global.html#clearPeticiones">clearPeticiones</a></li><li><a href="global.html#closeModal">closeModal</a></li><li><a href="global.html#CONFIGURACION_LOGGER">CONFIGURACION_LOGGER</a></li><li><a href="global.html#constructor">constructor</a></li><li><a href="global.html#consultarGastos">consultarGastos</a></li><li><a href="global.html#contentLoadedFotografias">contentLoadedFotografias</a></li><li><a href="global.html#crearDocumento">crearDocumento</a></li><li><a href="global.html#crearInspeccion">crearInspeccion</a></li><li><a href="global.html#createDatabase">createDatabase</a></li><li><a href="global.html#datos">datos</a></li><li><a href="global.html#deleteBitacora">deleteBitacora</a></li><li><a href="global.html#deleteDatabase">deleteDatabase</a></li><li><a href="global.html#deletePeticion">deletePeticion</a></li><li><a href="global.html#DescripcionPeticion">DescripcionPeticion</a></li><li><a href="global.html#dialogoComfirmarCambiosInspeccion">dialogoComfirmarCambiosInspeccion</a></li><li><a href="global.html#dialogoEditarInspeccion">dialogoEditarInspeccion</a></li><li><a href="global.html#docFotoToJson">docFotoToJson</a></li><li><a href="global.html#documento">documento</a></li><li><a href="global.html#downloadLogFile">downloadLogFile</a></li><li><a href="global.html#downloadPDF">downloadPDF</a></li><li><a href="global.html#downloadPhoto">downloadPhoto</a></li><li><a href="global.html#downloadPhotos">downloadPhotos</a></li><li><a href="global.html#dropDatabasePromise">dropDatabasePromise</a></li><li><a href="global.html#enviarPeticionesPendientes">enviarPeticionesPendientes</a></li><li><a href="global.html#faltanDatosSiniestro">faltanDatosSiniestro</a></li><li><a href="global.html#FormatearPeticion">FormatearPeticion</a></li><li><a href="global.html#FormularioInspeccion">FormularioInspeccion</a></li><li><a href="global.html#fotoInspeccionToJson">fotoInspeccionToJson</a></li><li><a href="global.html#getBitacoraData">getBitacoraData</a></li><li><a href="global.html#getBitacoraParams">getBitacoraParams</a></li><li><a href="global.html#getDataReporteGasto">getDataReporteGasto</a></li><li><a href="global.html#getGastoData">getGastoData</a></li><li><a href="global.html#getGastoParams">getGastoParams</a></li><li><a href="global.html#getLogger">getLogger</a></li><li><a href="global.html#getUUID">getUUID</a></li><li><a href="global.html#guardarBitacora">guardarBitacora</a></li><li><a href="global.html#guardarBitacoraFacturableYNueva">guardarBitacoraFacturableYNueva</a></li><li><a href="global.html#guardarBitacoraFacturableYSalir">guardarBitacoraFacturableYSalir</a></li><li><a href="global.html#guardarBitacoraNoFacturableYNueva">guardarBitacoraNoFacturableYNueva</a></li><li><a href="global.html#guardarBitacoraNoFacturableYSalir">guardarBitacoraNoFacturableYSalir</a></li><li><a href="global.html#guardarBitacoras">guardarBitacoras</a></li><li><a href="global.html#guardarCambioBitacora">guardarCambioBitacora</a></li><li><a href="global.html#guardarCambios">guardarCambios</a></li><li><a href="global.html#guardarConceptos">guardarConceptos</a></li><li><a href="global.html#guardarEstadoInspeccion">guardarEstadoInspeccion</a></li><li><a href="global.html#guardarGrupoDocumento">guardarGrupoDocumento</a></li><li><a href="global.html#guardarMonedas">guardarMonedas</a></li><li><a href="global.html#guardarNuevoGasto">guardarNuevoGasto</a></li><li><a href="global.html#guardarPeticion">guardarPeticion</a></li><li><a href="global.html#guardarPeticionPromise">guardarPeticionPromise</a></li><li><a href="global.html#guardarSiniestro">guardarSiniestro</a></li><li><a href="global.html#guardarSubtarea">guardarSubtarea</a></li><li><a href="global.html#guardarTarea">guardarTarea</a></li><li><a href="global.html#guardarTipoAnexo">guardarTipoAnexo</a></li><li><a href="global.html#guardarTipoFoto">guardarTipoFoto</a></li><li><a href="global.html#initBitacora">initBitacora</a></li><li><a href="global.html#initNuevoDetalle">initNuevoDetalle</a></li><li><a href="global.html#initNuevoGasto">initNuevoGasto</a></li><li><a href="global.html#initRefSin">initRefSin</a></li><li><a href="global.html#initResultadosSiniestro">initResultadosSiniestro</a></li><li><a href="global.html#initSendGastos">initSendGastos</a></li><li><a href="global.html#inspeccion">inspeccion</a></li><li><a href="global.html#inspeccionBuscarSin">inspeccionBuscarSin</a></li><li><a href="global.html#inspeccionCambioRegistrado">inspeccionCambioRegistrado</a></li><li><a href="global.html#inspeccionHabilitarEditarSiniestro">inspeccionHabilitarEditarSiniestro</a></li><li><a href="global.html#InspeccionService">InspeccionService</a></li><li><a href="global.html#isSynced">isSynced</a></li><li><a href="global.html#lastUserAct">lastUserAct</a></li><li><a href="global.html#limpiarCampos">limpiarCampos</a></li><li><a href="global.html#loadBitacora">loadBitacora</a></li><li><a href="global.html#loadSubtareas">loadSubtareas</a></li><li><a href="global.html#Migraciones">Migraciones</a></li><li><a href="global.html#mostrarGastos">mostrarGastos</a></li><li><a href="global.html#mostrarInspeccion">mostrarInspeccion</a></li><li><a href="global.html#mostrarNuevaInspeccion">mostrarNuevaInspeccion</a></li><li><a href="global.html#mostrarReporteGasto">mostrarReporteGasto</a></li><li><a href="global.html#nuevaBitacoraNoFacturable">nuevaBitacoraNoFacturable</a></li><li><a href="global.html#obtenerFecha">obtenerFecha</a></li><li><a href="global.html#obtenerFechaHHMMSS">obtenerFechaHHMMSS</a></li><li><a href="global.html#openEnviarIns">openEnviarIns</a></li><li><a href="global.html#openFotografiasCargadas">openFotografiasCargadas</a></li><li><a href="global.html#openPhotoCamera">openPhotoCamera</a></li><li><a href="global.html#openPhotoLibrary">openPhotoLibrary</a></li><li><a href="global.html#optionBitaFact">optionBitaFact</a></li><li><a href="global.html#paginasTotales">paginasTotales</a></li><li><a href="global.html#panelUsuario">panelUsuario</a></li><li><a href="global.html#progressBar">progressBar</a></li><li><a href="global.html#reducePictureSize">reducePictureSize</a></li><li><a href="global.html#refLog">refLog</a></li><li><a href="global.html#resetAllError">resetAllError</a></li><li><a href="global.html#resolveLocalDevicePath">resolveLocalDevicePath</a></li><li><a href="global.html#resultadosBitacora">resultadosBitacora</a></li><li><a href="global.html#resultadosDatos">resultadosDatos</a></li><li><a href="global.html#resultadosInspeccion">resultadosInspeccion</a></li><li><a href="global.html#resultadosInspeccionSin">resultadosInspeccionSin</a></li><li><a href="global.html#rowsAsList">rowsAsList</a></li><li><a href="global.html#savebase64AsPDF">savebase64AsPDF</a></li><li><a href="global.html#saveDataUser">saveDataUser</a></li><li><a href="global.html#saveEmail">saveEmail</a></li><li><a href="global.html#savePhotoFile">savePhotoFile</a></li><li><a href="global.html#saveRequest">saveRequest</a></li><li><a href="global.html#saveResponse">saveResponse</a></li><li><a href="global.html#select">select</a></li><li><a href="global.html#sendCambiosBitacora">sendCambiosBitacora</a></li><li><a href="global.html#sendMail">sendMail</a></li><li><a href="global.html#sendPeticiones">sendPeticiones</a></li><li><a href="global.html#setDataSiniestro">setDataSiniestro</a></li><li><a href="global.html#setOptions">setOptions</a></li><li><a href="global.html#showFotosCargadas">showFotosCargadas</a></li><li><a href="global.html#showModal">showModal</a></li><li><a href="global.html#sqlError">sqlError</a></li><li><a href="global.html#sqlPromise">sqlPromise</a></li><li><a href="global.html#sqlQuery">sqlQuery</a></li><li><a href="global.html#stringToBlob">stringToBlob</a></li><li><a href="global.html#submitDocumentoCargado">submitDocumentoCargado</a></li><li><a href="global.html#submitInspeccionSeleccionada">submitInspeccionSeleccionada</a></li><li><a href="global.html#submitNuevasFotografias">submitNuevasFotografias</a></li><li><a href="global.html#submitRepoGasto">submitRepoGasto</a></li><li><a href="global.html#submitValidateGastosReport">submitValidateGastosReport</a></li><li><a href="global.html#syncLocalData">syncLocalData</a></li><li><a href="global.html#takePhoto">takePhoto</a></li><li><a href="global.html#updateAnticipo">updateAnticipo</a></li><li><a href="global.html#updateBitacora">updateBitacora</a></li><li><a href="global.html#updateBitaNoFact">updateBitaNoFact</a></li><li><a href="global.html#updateEstado">updateEstado</a></li><li><a href="global.html#updateLocalData">updateLocalData</a></li><li><a href="global.html#updateNombreFoto">updateNombreFoto</a></li><li><a href="global.html#updatePagesGasto">updatePagesGasto</a></li><li><a href="global.html#uploadFile">uploadFile</a></li><li><a href="global.html#validacionNuevaBitacora">validacionNuevaBitacora</a></li><li><a href="global.html#validarInspeccionSinSiniestro">validarInspeccionSinSiniestro</a></li><li><a href="global.html#validateDocumentoCargado">validateDocumentoCargado</a></li><li><a href="global.html#validateEnviarIns">validateEnviarIns</a></li><li><a href="global.html#validateGastosReport">validateGastosReport</a></li><li><a href="global.html#validateNuevasFotografias">validateNuevasFotografias</a></li><li><a href="global.html#validateNuevoDetalleGasto">validateNuevoDetalleGasto</a></li><li><a href="global.html#validateNuevoRepGasto">validateNuevoRepGasto</a></li><li><a href="global.html#value">value</a></li><li><a href="global.html#verBitacora">verBitacora</a></li><li><a href="global.html#verInspeccion">verInspeccion</a></li><li><a href="global.html#verInspeccionSin">verInspeccionSin</a></li><li><a href="global.html#verReporteGasto">verReporteGasto</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.4</a> on Fri Oct 16 2020 08:31:37 GMT-0700 (Pacific Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
