<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: gasto/gastos.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: gasto/gastos.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>var salir; //Variable que indica si despues de registrar un gasto desea salir o continuar
var gastoLog = getLogger('gasto');
//Insertar un reporte de gasto
var insertGasto = 'INSERT INTO Gasto (gastos_repor_id, '
            + 'gastos_repor_caso, '
            + 'gastos_repor_consecu, ' 
            + 'gastos_repor_user, '
            + 'gastos_repor_ajustador, '
            + 'gastos_repor_moneda, '
            + 'gastos_repor_anticipo, '
            + 'gastos_repor_nombre, '
            + 'gastos_repor_f_ini, '
            + 'gastos_repor_f_fin, '
            + 'gastos_repor_mail, '
            + 'gastos_repor_coment, '
            + 'gastos_repor_fecha_envi, '
            + 'gastos_repor_fecha, '
            + 'ajustador, '
            + 'correspon_caso, '
            + 'page) VALUES (?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)';
//Actualizar un reporte de gasto
var updateGasto = 'UPDATE Gasto SET gastos_repor_id = ?, '
            + 'gastos_repor_caso = ?, '
            + 'gastos_repor_consecu = ?, ' 
            + 'gastos_repor_user = ?, '
            + 'gastos_repor_ajustador = ?, '
            + 'gastos_repor_moneda = ?, '
            + 'gastos_repor_anticipo = ?, '
            + 'gastos_repor_nombre = ?, '
            + 'gastos_repor_f_ini = ?, '
            + 'gastos_repor_f_fin = ?, '
            + 'gastos_repor_mail = ?, '
            + 'gastos_repor_coment = ?, '
            + 'gastos_repor_fecha_envi = ?, '
            + 'gastos_repor_fecha = ?, '
            + 'ajustador = ?, '
            + 'correspon_caso = ? WHERE idGasto = ?';
//Actualizar un reporte de gasto sin remplazar datos
var updateGasto2 = 'UPDATE Gasto SET gastos_repor_id = ?, '
            + 'gastos_repor_caso = ?, '
            + 'gastos_repor_consecu = ?, '
            + 'gastos_repor_user = ?, '
            + 'gastos_repor_ajustador = ?, '
            + 'gastos_repor_moneda = ?, '
            + 'gastos_repor_nombre = ?, '
            + 'gastos_repor_f_ini = ?, '
            + 'gastos_repor_f_fin = ?, '
            + 'gastos_repor_mail = ?, '
            + 'gastos_repor_coment = ?, '
            + 'gastos_repor_fecha_envi = ?, '
            + 'gastos_repor_fecha = ?, '
            + 'ajustador = ?, '
            + 'correspon_caso = ? WHERE idGasto = ?';
//Actualizar un detalle de gasto
var queryUpdateDGasto = 'UPDATE DetalleGasto SET gastos_id = ?, '
            + 'gastos_caso = ?, '
            + 'gastos_user = ?, '
            + 'gastos_ajustador = ?, '
            + 'gastos_visada = ?, '
            + 'gastos_id_reporte = ?, '
            + 'gastos_valor = ?, '
            + 'gastos_cargar = ?, '
            + 'gastos_moneda = ?, '
            + 'gastos_fecha_real = ?, '
            + 'gastos_emisor = ?, '
            + 'gastos_descripcion = ?, '
            + 'gastos_concepto = ?, '
            + 'gastos_razon_social = ?, '
            + 'gastos_viaje_ini = ?, '
            + 'gastos_viaje_fin = ?, '
            + 'gastos_amex = ?, '
            + 'gastos_nulo = ?, '
            + 'gastos_archivo = ?, '
            + 'gastos_archivo_xml = ?, '
            + 'gastos_archivo_3 = ?, '
            + 'gastos_fecha = ? '
            + 'WHERE idDetalleGasto = ?';

/**************************************************************
                    * LISTA DE GASTOS*
 **************************************************************/

/**
 * Consulta la lista de gastos en el servidor
 * @param {*} page 
 */
function consultarGastos(page) {
    // si esta en la pantalla de nuevo gasto y esta eligiendo un ajustador
    // se debe ocultar la seleccion del ajustador
    let seleccionAjustador = document.getElementById('seleccionarAjustador');
    if (seleccionAjustador != null &amp;&amp; seleccionAjustador.style.display == 'block') {
        document.querySelectorAll('ons-card').forEach(card => card.style.display = 'block');
        document.getElementById('seleccionarAjustador').style.display = 'none';
        return;
    }
    showLoading();
    fn.load('gastos.html');
    //Se eliminan los datos locales de otros siniestros
    window.localStorage.removeItem("tituloGasto");
    window.localStorage.removeItem("monedaGasto");
    window.localStorage.removeItem("idGastoLocal");
    window.localStorage.removeItem("idGastoServidor");
    window.localStorage.removeItem("idDetalleGasto");
    //Se obtiene el siniestro actual
    let idSiniestro = window.localStorage.getItem("idSiniestroServidor");
    if (idSiniestro == null)
        idSiniestro = 0;
    gastoLog.debug('consultando gastos', {page, idSiniestro, synced: isSynced(), conexion: verificarConexion()});
    window.localStorage.setItem("pageActual", page);

    if(verificarConexion() == true &amp;&amp; (isSynced() == true || isSynced() == "true")){ //Si tiene internet consulta los gastos con el servidor
        window.localStorage.removeItem("limitGastoUsuario"); 
        GastosService.obtenerGastosConteo(idSiniestro).then(conteo => {
            console.error('conteo de gastos ', conteo)
            if (conteo == 0) { 
                actualizarListadoGasto(idSiniestro)
            } else {
                getGastoData(idSiniestro, page);
            }
        })

    } else {
        if(idSiniestro != null &amp;&amp; idSiniestro != undefined){
            getGastoData(idSiniestro, page);
        }else{
            window.localStorage.setItem("limitGastoUsuario", 10);
            getGastoData(0, page)
        }        
    }
}

/**
 * Actualiza el listado de gastos
 * @param {number} idSiniestro 
 */
function actualizarListadoGasto() {
    let idSiniestro = window.localStorage.getItem("idSiniestroServidor");
    console.error('idSiniestro', idSiniestro)
    if (idSiniestro == null)
        idSiniestro = 0;
    let caso_gasto = window.localStorage.getItem("idSiniestroServidor");
    createAlertDialog('dialogoActualizarGastos', 'dialogoActualizarGastos.html')
    GastosService.obtenerListaGastoServidor(idSiniestro).then(listado => {
        let promesas = [];
        for (let i = 0; i &lt; listado.resultados.length; i++) {
            let gastoServidor = listado.resultados[i];
            let promesa = GastosService.obtenerGastoPorGastosReporId(gastoServidor.gastos_repor_id).then(gasto => {
                if (gasto != null) { // existe se debe actualizar
                    return GastosService.gastoTienePeticionesPendiente(gasto.idGasto).then(tienePendiente => {
                        if (tienePendiente) { // este gasto tiene cambios pendientes de subir al servidor
                            console.error('este gasto tiene peticiones pendiente', gasto)
                            return
                        }
                        gastoServidor.correspon_caso = caso_gasto != null ? caso_gasto : 0;
                        gastoServidor.idGasto = gasto.idGasto;
                        return GastosService.actualizarGasto(gastoServidor);     
                    })
                } else { // no existe, se inserta en la BD
                    gastoServidor.correspon_caso = caso_gasto != null ? caso_gasto : 0;
                    return GastosService.insertarGasto(gastoServidor);
                }
            });
            promesas.push(promesa)
        }
        return Promise.all(promesas).then(() => {
            updatePagesGasto(() => getGastoData(idSiniestro, 1)) 
        })
    })
    .catch(error => {
        gastoLog.error('No se pudo actualizar el listado de gastos', error);
        showError('No se pudo actualizar el listado de gastos')
    })
    .finally(() => hideAlertDialog('dialogoActualizarGastos'))
}

/**
 * Función que obtiene los datos de la base de
 * datos y prepara para mostrar en pantalla
 * @param {*} idSiniestro 
 * @param {*} page 
 */
function getGastoData(idSiniestro, page){
    gastoLog.debug('obteniendo gasto de la base de datos', idSiniestro, page);
    var orden;
    var params = new Array();
    if(idSiniestro == 0){//Si no tiene siniestro
        orden = 'AND page = ? ORDER BY gastos_repor_consecu DESC';
    }else{ //Si tiene un siniestro
        orden = 'AND page = ? ORDER BY gastos_repor_consecu ASC';
    }
    //Se declaran los parametros
    params.push(idSiniestro);
    params.push(page);
    //Se obtiene el limite de resultados con base al limite del usuario
    var limitQuery = window.localStorage.getItem("limitGastoUsuario");
    limitQuery = limitQuery ? limitQuery : 20;

    sqlQuery('SELECT * FROM Gasto WHERE gastos_repor_caso = ?  ' + orden + ' LIMIT ' + limitQuery, params, function(listGastos){
        var totalRegGastos = window.localStorage.getItem("totalRegGastos");
        if(totalRegGastos != null &amp;&amp; totalRegGastos != undefined){
            mostrarGastos(listGastos, page);
        }else{
            sqlQuery('SELECT COUNT(*) FROM Gasto WHERE gastos_repor_caso = ?', [idSiniestro], function(registrosTotales){
                if(registrosTotales){
                    if(registrosTotales[0]["COUNT(*)"]){
                        window.localStorage.setItem("totalRegGastos", registrosTotales[0]["COUNT(*)"]);
                    }
                }
                mostrarGastos(listGastos, page);
            });
        }
    });
}


/**
 * Función que muestra el 
 * listado de gastos
 * @param {*} listaGastos 
 * @param {*} pageActual 
 */
function mostrarGastos(listaGastos, pageActual){
    hideLoading();
    var html = '';
    var titleApp = window.localStorage.getItem("titleApp");
    var totalRegGastos = 0;
    if(listaGastos != null){
        totalRegGastos = listaGastos.length;
    }
    var gastoUserLim = window.localStorage.getItem("limitGastoUsuario");
    window.localStorage.removeItem("monedaGasto");
    window.localStorage.removeItem("idGasto");
    window.localStorage.removeItem("numeroReporte");
    $('#titleApp').html(titleApp);
    var idSiniestro = window.localStorage.getItem("idSiniestroServidor");
    if(listaGastos != null){
        if(listaGastos.length > 0){
            //Tabla
            html += '&lt;table class="table tableKronos table-striped table-sm shadow-sm">';
                //Encabezado de tabla
                html += '&lt;thead>'
                        +    '&lt;tr>';
                        if(idSiniestro != null &amp;&amp; idSiniestro != undefined){
                            html += '&lt;th>Ref. R&amp;G N°&lt;/th>';
                        }else{
                            html += '&lt;th>Fecha&lt;/th>';
                        }                    
                        html += '&lt;th>Ajustador&lt;/th>'
                        + '&lt;th>Consecutivo&lt;/th>'
                        + '&lt;/tr>'
                        +'&lt;/thead>';

                //Elementos de la tabla
                html += '&lt;tbody>';
                listaGastos.forEach(function(gasto){
                    html += '&lt;tr onclick="verReporteGasto(' + gasto.gastos_repor_id + ', ' + gasto.idGasto + ');">';
                        if(idSiniestro != null &amp;&amp; idSiniestro != undefined){
                            html += '&lt;th style="color:#FE8416;">' + idSiniestro + '&lt;/th>';
                        }else{
                            html += '&lt;th style="color:#FE8416;">' + fn.formatDate(gasto.gastos_repor_fecha, " ") + '&lt;/th>';
                        }
                        html += '&lt;th>' + gasto.ajustador + '&lt;/th>';
                        if(gasto.gastos_repor_consecu != null &amp;&amp; gasto.gastos_repor_consecu != 0){
                            html += '&lt;th>' + numeral(gasto.gastos_repor_consecu).format('000') + '&lt;/th>';
                        }else{
                            html += '&lt;th>---&lt;/th>';
                        }
                    html += '&lt;/tr>';
                });
                html += '&lt;/tbody>';
            html += '&lt;/table>';
            GastosService.obtenerGastosConteo(idSiniestro).then(total => {
                let limite = 10;
                if (idSiniestro != null &amp;&amp; idSiniestro > 0) {
                    limite = 20;
                }
                window.localStorage.setItem("limitGastoUsuario", limite);
                html += fn.pagination(total, pageActual);
                html += fn.dataViewed(total, pageActual, fn.dinamicLimit(limite)); //Indica numero de resultados
                $('#gastosContent').html(html);
                $('#page-' + pageActual).addClass("active");
                $('.pagNumberPage').click(function(){
                    var id = $(this).attr('id');
                    pageObj = id.split("-")[1];
                    consultarGastos(pageObj);
                });
            })
        }else{
            html += '&lt;center>&lt;h4>No se encuentran gastos o no se han cargado&lt;/h4>&lt;/center>';
            if(totalRegGastos &amp;&amp; totalRegGastos != null){
                html += fn.pagination(totalRegGastos, pageActual);
                html += fn.dataViewed(totalRegGastos, pageActual, fn.dinamicLimit(gastoUserLim?gastoUserLim:10)); //Indica numero de resultados
            }
        }
    }else{
        html += '&lt;center>&lt;h4>No se encuentran gastos o no se han cargado&lt;/h4>&lt;/center>';
    }
    $('#gastosContent').html(html);
    $('#page-' + pageActual).addClass("active");
    $('#btnNuevoReporteGasto').attr('disabled', false);
    //Funcion cuando se presiona el botón
    $('.pagNumberPage').click(function(){
        var id = $(this).attr('id');
        pageObj = id.split("-")[1];
        consultarGastos(pageObj);
    });
    hideLoading();
}

/**************************************************************
                    * REPORTE DE GASTO*
 **************************************************************/

/**
 * Función que busca en el servidor 
 * el reporte general de un gasto
 * @param {*} gastos_repor_id 
 */
function verReporteGasto(gastos_repor_id, idGasto){
    window.localStorage.setItem("idGastoLocal", idGasto); //Inicio de sesión inteli
    window.localStorage.setItem("idGastoServidor", gastos_repor_id);
    fn.load('reporteGasto.html');
    gastoLog.debug('obteniendo reporte gasto', {
        conexion: verificarConexion(), 
        synced: isSynced(),
        gastos_repor_id
    });
    if(verificarConexion() == true) {
        showLoading();
        if(gastos_repor_id != null &amp;&amp; gastos_repor_id != undefined){ //Si existe el numero de reporte de gasto
            GastosService.actualizarDetallesDeGasto(gastos_repor_id, idGasto)
                .then(() => getDataReporteGasto(idGasto))
        }else{
            getDataReporteGasto(idGasto);
        }        
    }else{
        getDataReporteGasto(idGasto);
    }    
}

/**
 * Función que obtiene los datos
 * del reporte de gastos para 
 * imprimirlos en pantalla
 */
function getDataReporteGasto(idGasto){
    showLoading();
    gastoLog.debug(`obteniendo reporte gasto de la BD idGasto:${idGasto}`)
    sqlQuery('SELECT * FROM Gasto WHERE idGasto = ?', [idGasto], function(reportGasto){
        if(reportGasto != true){
            sqlQuery(`SELECT * FROM DetalleGasto d 
                LEFT JOIN Peticiones p ON p.entidad = 'EliminarDetalleGasto' AND p.estatus = 'PEND'
                    AND d.idDetalleGasto = p.identificador
                WHERE fk_idGasto = ? AND p.identificador IS NULL`, [idGasto], function(detalleGasto){
                if(detalleGasto == true){
                    mostrarReporteGasto(reportGasto, null);
                    if(verificarConexion() != true){
                        showNotice("No hay conexión a Internet");
                    }
                }else{
                    mostrarReporteGasto(reportGasto, detalleGasto);
                }
            });
        }else{
            showError('No se ha podido consultar el reporte de gasto');
        }
        hideLoading();
    });
}
/**
 * Función que muestra el reporte del gasto
 * @param {*} reporteGasto 
 */
function mostrarReporteGasto(reporteGasto, detalleGasto){
    var titleApp = window.localStorage.getItem("titleApp");
    window.localStorage.removeItem("comprob1");
    $('#titleApp').html(titleApp);
    var caso_reporte_gasto = reporteGasto[0].gastos_repor_caso;
    caso_reporte_gasto = caso_reporte_gasto ? caso_reporte_gasto : 0;
    var title = 'Reporte N°' + caso_reporte_gasto + '-' + reporteGasto[0].ajustador + '-' + numeral(reporteGasto[0].gastos_repor_consecu).format('000');
    window.localStorage.setItem("tituloGasto", title);
    $('#titlePage').append(title);
    //Numero de siniestro
    $('#numeroSiniestro').html(reporteGasto[0].gastos_repor_caso);
    //Anticipo
    $('#inpAnticipo').val(reporteGasto[0].gastos_repor_anticipo);
    //Moneda
    $('#gastos_repor_moneda').html(reporteGasto[0].gastos_repor_moneda);
    window.localStorage.setItem("monedaGasto", reporteGasto[0].gastos_repor_moneda);
    //Id del reporte de gasto
    $('#gasto_id').val(reporteGasto[0].gastos_repor_id);
    //Id del reporte de gasto
    $('#idGasto').val(reporteGasto[0].idGasto);

    window.localStorage.setItem("idGasto", reporteGasto[0].idGasto);
    window.localStorage.setItem("numeroReporte", reporteGasto[0].gastos_repor_id);

    var html = '';
    var html2 = '';
    //Se revisa si existe informacion
    if(detalleGasto != null){
        if(detalleGasto.length != 0){
            html += fn.dataViewed(detalleGasto.length, 1, detalleGasto.length); //Indica numero de resultados
            //Tabla
            html += '&lt;table class="table tableKronos table-striped table-sm m-0">';
                //Encabezado de tabla
                html += '&lt;thead>'
                        +    '&lt;tr>'
                        +        '&lt;th>Ajustador&lt;/th>'
                        +        '&lt;th>Concepto&lt;/th>'
                        +        '&lt;th>Total&lt;/th>'
                        +    '&lt;/tr>'
                        +'&lt;/thead>';
                //Elementos de la tabla
                html += '&lt;tbody>';
                detalleGasto.forEach(function(detalle){
                    html += '&lt;tr onclick="TablaDetalleGasto.verDetalleGasto(' + detalle.idDetalleGasto + ', ' + reporteGasto[0].idGasto + ');">';
                        html += '&lt;th>' + detalle.ajustador + '&lt;/th>';
                        html += '&lt;th style="color:#FE8416;">' + detalle.gastos_concepto + '&lt;/th>';
                        html += '&lt;th>' + detalle.gastos_valor + '&lt;/th>';
                    html += '&lt;/tr>';
                });
                html += '&lt;/tbody>';
            html += '&lt;/table>';
        }else{
            html += '&lt;center>&lt;h4>No hay detalle relacionado&lt;/h4>&lt;/center>';
        }
    }else{
        html += '&lt;center>&lt;h4>No hay detalle relacionado&lt;/h4>&lt;/center>';
    }
    let reporteGastoSeleccionado = reporteGasto[0];
    console.error('id ajustador', reporteGastoSeleccionado.gastos_repor_ajustador);
    CatalogoService.obtenerAjustadorPorId(reporteGastoSeleccionado.gastos_repor_ajustador).then(ajustador => {
        $('[data-ajustador-nombre]').val(ajustador.nombre);
        $('[data-ajustador-nombre-defecto]').val(ajustador.nombre);
    }).catch(e => {
        $('[data-ajustador-nombre]').val(reporteGastoSeleccionado.ajustador);
        $('[data-ajustador-nombre-defecto]').val(reporteGastoSeleccionado.ajustador);
    })
    html2 += '&lt;ons-list-item modifier="longdivider">'
            + '&lt;center>'
                + '&lt;ons-button modifier="quiet" class="center sh-none" style="width: 250px;font-size:18px;background-color:#D8DADB;color:#0081BD;" onclick="updateAnticipo();">'
                    + '&lt;ons-icon icon="md-card-sd" style="width: 25px; color: #FE8416;">&lt;/ons-icon>'
                    + 'Actualizar Anticipo'
                + '&lt;/ons-button>'
            + '&lt;/center>'
        + '&lt;/ons-list-item>';
    if(detalleGasto != null){
        if(detalleGasto.length != 0){
            html2 += '&lt;ons-list-item modifier="longdivider">'
                + '&lt;center>'
                    + '&lt;ons-button modifier="quiet" class="center sh-none" style="width: 250px;font-size:18px;background-color:#D8DADB;color:#0081BD;" onclick="initSendGastos();">'
                        + '&lt;ons-icon icon="check" style="width: 25px; color: #FE8416;">&lt;/ons-icon>'
                        + 'Enviar Gastos'
                    + '&lt;/ons-button>'
                + '&lt;/center>'
            + '&lt;/ons-list-item>';
        }    
    }
    $('#detalleReporteContent').html(html);
    $('#optionButtons').html(html2);
    hideLoading();
    $('#btnNuevoDetalleGasto').attr('disabled', false);
}

/**
 * Función para cargar la pantalla de un nuevo gasto
 */
function initNuevoGasto(){
    //id del siniestro actual
    var idSiniestro = window.localStorage.getItem("idSiniestroServidor");
    //Titulo de pantalla
    var titleApp = window.localStorage.getItem("titleApp");
    fn.load('nuevoReporteGasto.html').then(() => {
        if (idSiniestro != null &amp;&amp; idSiniestro != '' &amp;&amp; idSiniestro != '0') {
            document.querySelector('[data-ajustador-id]').value = window.localStorage.getItem("idUser");;
            document.querySelector('[data-ajustador-id-defecto]').value = window.localStorage.getItem("idUser");
            document.querySelector('[data-seleccionar-ajustador]').style.display = 'none';
            document.querySelector('[data-limpiar-ajustador]').style.display = 'none';
        } else {
            document.querySelector('[data-cambiar-ajustador]').style.display = 'none'
            document.querySelector('[data-limpiar-ajustador]').style.display = 'none';
        }
    })
    showLoading();
    //Se obtienen los datos del siniestro
    showLoading();
    sqlQuery('SELECT * FROM Siniestro WHERE caso_id = ?', [idSiniestro], function(datosSiniestro){
        var html = '';
        if(datosSiniestro!=true){
            if(datosSiniestro[0].caso_n_siniestro != null &amp;&amp; datosSiniestro[0].caso_n_siniestro != undefined){
                html += '&lt;td>&lt;strong>Siniestro N°&lt;/strong>&lt;/td>'
                        + '&lt;td>' + datosSiniestro[0].caso_n_siniestro + '&lt;/td>';
            }  
            $('#siniestroExiste').html(html);    
            $('#gastos_repor_caso').val(datosSiniestro[0].caso_id);
            $('#titleApp').html(titleApp);
        }
        hideLoading();
    });

    //Se obtiene el catálogo de moneda
    showLoading();
    sqlQuery('SELECT * FROM CatalogoMoneda WHERE moneda_estado = ? ORDER BY moneda_nombre ASC', [1], function(monedas){
        if(monedas != true){
            var selectMonedas = '';
            selectMonedas += '&lt;ons-select id="gasto_moneda" required>';
            selectMonedas += '&lt;option value="" >Seleccione una opción ...&lt;/option>';
            monedas.forEach(function(moneda){
                selectMonedas += '&lt;option value="' + moneda.moneda_id + '" >' + moneda.moneda_nombre + '&lt;/option>';
            });
            selectMonedas += '&lt;/ons-select>';
            $('#gastos_moneda').html(selectMonedas);   
            validateNuevoRepGasto();
        }
        hideLoading();
    });    
    //Se obtienen los datos del usuario
    CatalogoService.obtenerDatosUsuarioActual().then(datosUsuario => {
        $('[data-ajustador-nombre]').val(datosUsuario.user_nombre);
        $('[data-ajustador-nombre-defecto]').val(datosUsuario.user_nombre);
        $('[data-ajustador-iniciales]').val(datosUsuario.user_iniciales);
        $('[data-ajustador-iniciales-defecto]').val(datosUsuario.user_iniciales);
    })
}

/**
 * Función que inicializa las validaciones
 * para el formulario
 * de agregar un nuevo reporte gasto
 */
function validateNuevoRepGasto(){
    $('#nuevoRepoGasto').validate({
        errorClass: "errorForm",
        validClass: "validForm",
        submitHandler: function(){
            guardarNuevoGasto();
        },
        invalidHandler: function (event, validator){
            if(validator.numberOfInvalids()){
                showError("Revisa los campos marcados");
            }
        }
    });
}

/**
 * Función para validar el formulario
 * de nuevo reporte gasto
 */
function submitRepoGasto(){
    $('#nuevoRepoGasto').submit();
}

/**
 * Función para guardar un nuevo
 * gasto
 */
function guardarNuevoGasto(){
    var params;
    var arrayParams = new Array();
    var idMoneda = $('#gasto_moneda').val();
    var caso_gasto = window.localStorage.getItem("idSiniestroServidor");
    var pageIni = window.localStorage.getItem("lastPageGasto")?window.localStorage.getItem("lastPageGasto"):1;
    var totalRegGastos = window.localStorage.getItem("totalRegGastos");
    document.getElementById('btnCrearReporteGasto').setAttribute('disabled', 'disabled');
    document.getElementById('btnCrearReporteGasto').insertAdjacentHTML('beforeend', `&lt;span class="spinner-grow spinner-grow-sm" role="status" aria-hidden="true">&lt;/span>`)
    sqlQuery('SELECT * FROM Gasto WHERE correspon_caso = ? ORDER BY gastos_repor_id DESC', [caso_gasto?caso_gasto:0], function(gastoConsecu){
        if(gastoConsecu != true){
            totalRegGastos = totalRegGastos ? totalRegGastos : gastoConsecu.length;
            getMonedaPorId(idMoneda, function(moneda){
                sqlQuery('SELECT COUNT(*) FROM Gasto WHERE page = ? AND correspon_caso = ?', [pageIni, caso_gasto?caso_gasto:0], function(regPage){
                    //Se verifica si el ajustador actual tiene un siniestro
                    if(caso_gasto != null &amp;&amp; caso_gasto != undefined){
                        params = getGastoParams(totalRegGastos, moneda.moneda_nombre);
                    }else{
                        params = getGastoParams(0, moneda.moneda_nombre, true);
                    }
                    
                    GastosService.obtenerSiguienteConsecutivo(caso_gasto)
                        .then(consecutivo => {

                            params.gastos_repor_consecu = consecutivo
                            gastoLog.debug('guardando nuevo gasto consecutivo', params);
                            arrayParams = fn.JsonToArray(params);
                            //Se verifica la cantidad de registros por página
                            if(regPage){
                                if(regPage[0]["COUNT(*)"] &lt; 20){
                                    arrayParams.push(pageIni);
                                }else{
                                    window.localStorage.removeItem("lastPageGasto");
                                    pageIni++;
                                    window.localStorage.setItem("lastPageGasto", pageIni);
                                    arrayParams.push(pageIni);
                                }
                            }
                            sqlQuery(insertGasto, arrayParams, function(idUltimoGasto){
                                if(idUltimoGasto){
                                    guardarPeticionPromise('ajustador_gastos.php', 'POST', 'Gasto', 'idGasto', idUltimoGasto).then(r => {
                                        var totalRegGastos = window.localStorage.getItem("totalRegGastos");
                                        window.localStorage.removeItem("totalRegGastos");
                                        totalRegGastos++;
                                        window.localStorage.setItem("totalRegGastos", totalRegGastos);
                                        updatePagesGasto(function(success){ //Se actualiza la paginación
                                            showSuccess("Se ha generado el nuevo reporte correctamente");
                                            verReporteGasto(null, idUltimoGasto);
                                        });
                                    }).catch(error => {
                                        gastoLog.error('Error al guardar peticion de gasto', error)
                                        showError("Ha ocurrido un error, intentelo más tarde");
                                    })
                                }
                            }, true)
                        })
                })
            });        
        }else{
            totalRegGastos = totalRegGastos ? totalRegGastos : 0;
            getMonedaPorId(idMoneda, function(moneda){
                sqlQuery('SELECT COUNT(*) FROM Gasto WHERE page = ? AND correspon_caso = ?', [pageIni, caso_gasto?caso_gasto:0], function(regPage){
                    if(caso_gasto != null &amp;&amp; caso_gasto != undefined){
                        params = getGastoParams(totalRegGastos, moneda.moneda_nombre);   
                    }else{
                        params = getGastoParams(0, moneda.moneda_nombre, true);
                    }
                    GastosService.obtenerSiguienteConsecutivo(caso_gasto)
                        .then(consecutivo => {
                            params.gastos_repor_consecu = consecutivo
                            gastoLog.debug('guardando nuevo gasto no consecutivo', params);
                            arrayParams = fn.JsonToArray(params);
                            if(regPage){
                                if(regPage[0]["COUNT(*)"] &lt; 20){
                                    arrayParams.push(pageIni);
                                }else{
                                    window.localStorage.removeItem("lastPageGasto");
                                    pageIni++;
                                    window.localStorage.setItem("lastPageGasto", pageIni);
                                    arrayParams.push(pageIni);
                                }
                            }
                            sqlQuery(insertGasto, arrayParams, function(idUltimoGasto){
                                if(idUltimoGasto){
                                    guardarPeticion('ajustador_gastos.php', 'POST', 'Gasto', 'idGasto', idUltimoGasto, function(inserted){
                                        if(inserted){
                                            var totalRegGastos = window.localStorage.getItem("totalRegGastos");
                                            window.localStorage.removeItem("totalRegGastos");
                                            totalRegGastos++;
                                            window.localStorage.setItem("totalRegGastos", totalRegGastos);
                                            updatePagesGasto(function(success){ //Se actualiza la paginación
                                                showSuccess("Se ha generado el nuevo reporte correctamente");
                                                verReporteGasto(null, idUltimoGasto);
                                            });
                                        }else{
                                            showError("Ha ocurrido un error, intentelo más tarde");
                                        }
                                    });
                                }
                            }, true);
                        })
                });
            });
        }
    });
}

/**
 * Función para actualizar la paginación de
 * los gastos
 * @param {*} callback 
 */
function updatePagesGasto(callback){
    var idSiniestro = window.localStorage.getItem("idSiniestroServidor");
    var limitGastoUsuario = window.localStorage.getItem("limitGastoUsuario");
    var elementosPorPagina = 20;
    if (idSiniestro == null) {
        elementosPorPagina = 10;
    }
    gastoLog.debug('actualizando paginacion de los gatos limite:', limitGastoUsuario);
    sqlPromise('SELECT * FROM Gasto WHERE gastos_repor_caso = ? ORDER BY gastos_repor_consecu ASC', [idSiniestro != null ? idSiniestro : 0]).then(rowsAsList)
        .then(gastos => {
            let promesas = [];
            let pagina = 0;
            for (let i=0; i &lt; gastos.length; i += 1) {
                if (i % elementosPorPagina == 0)
                    pagina += 1;
                var promesa = sqlPromise('UPDATE Gasto SET page = ? WHERE idGasto = ?', [pagina, gastos[i].idGasto])
                promesas.push(promesa)
            }
            return Promise.all(promesas)
        })
        .catch(e => gastoLog.error('No se pudo actualizar la lista ', e))
        .finally(callback)
}

/**
 * Funcion para obtener los parametros
 * de un
 */
function getGastoParams(consecutivo, moneda, onlyAjustador){
    var repor_caso = $('#gastos_repor_caso').val();
    var repor_moneda = moneda;
    var repor_anticipo = $('#gastos_repor_anticipo').val();
    var repor_fecha = obtenerFecha(new Date);
    var gastos_repor_ajustador = $('#ajustador_id').val() != '' ? $('#ajustador_id').val() : window.localStorage.getItem("idUser");
    var ajustador = $('#user_iniciales').val();
    if(repor_caso != null &amp;&amp; repor_caso != undefined &amp;&amp; $.trim(repor_caso) != ""){
        var repor_nombre = repor_caso + '-' + ajustador + '-' + numeral(consecutivo+1).format('000');
    }else{
        var repor_nombre = ajustador + '-' + numeral(consecutivo+1).format('000');
    }
    var correspon_caso = window.localStorage.getItem('idSiniestroServidor');
    if(onlyAjustador != true){
        consecutivo++;
    }

    var gasto = {
        gastos_repor_id: null,
        gastos_repor_caso:repor_caso?repor_caso:0,
        gastos_repor_consecu:consecutivo,
        gastos_repor_user:null,
        gastos_repor_ajustador:gastos_repor_ajustador,
        gastos_repor_moneda:repor_moneda,
        gastos_repor_anticipo:repor_anticipo,
        gastos_repor_nombre:repor_nombre,
        gastos_repor_f_ini:null,
        gastos_repor_f_fin:null,
        gastos_repor_mail:null,
        gastos_repor_coment:null,
        gastos_repor_fecha_envi:null,
        gastos_repor_fecha:repor_fecha,
        ajustador:ajustador,
        correspon_caso: correspon_caso ? correspon_caso : 0
    }
    return gasto;
}

/**
 * Función para actualizar el anticipo del gasto
 */
function updateAnticipo() {
    gastoLog.debug('actualizando anticipo');
    var anticipo = $('#inpAnticipo').val();
    var idGasto = $('#idGasto').val();
    sqlQuery('UPDATE Gasto SET gastos_repor_anticipo = ?, changeLocal = ? WHERE idGasto = ?', [anticipo, true, idGasto], function(results){
        if(results == true){
            guardarPeticion('ajustador_gastos.php', 'put', 'Gasto', 'idGasto', idGasto);
            showSuccess('Se ha actualizado el anticipo correctamente');
        }
    });
}

/**
 * Función que inicializa el modal
 * para enviar los gastos
 */
function initSendGastos(){
    fn.load('sendGastos.html')
}

/**
 * Función que valida el formulario para enviar 
 * los gastos en correo
 */
function validateGastosReport(){
    $('#sendGastosReport').validate({
        errorClass: "errorForm",
        validClass: "validForm",
        submitHandler: function(){
            var emailsValid = checkEmails('emails');
            if(emailsValid == true){
                sendMail();
            }else{
                $('#emails').removeClass('validForm');
                $('#emails').addClass('errorForm');
                if(emailsValid.length == 1){
                    showError("E-mail inválido: " + emailsValid.toString());
                }else{
                    showError("E-mails inválidos: " + emailsValid.toString());
                }
            }
        },
        invalidHandler: function (event, validator){
            if(validator.numberOfInvalids()){
                showError("Revisa los campos marcados");
            }
        }
    });
}

/**
 * Función para hacer submit al
 * formulario para enviar un correo
 */
function submitValidateGastosReport(){
    $('#sendGastosReport').submit();
}

/**
 * Función para enviar mails
 * con los gastos correspondientes
 */
function sendMail(){
    var fech_ini = $('#fech_ini').val();
    var fech_fin = $('#fech_fin').val();
    var gastos_repor_mail = $('#emails').val();
    var gastos_repor_coment = $('#coment').val();
    var gastos_repor_id_anti;
    var gastos_repor_nombre;
    var idGasto = window.localStorage.getItem("idGasto");
    var nombreGastoProv = window.localStorage.getItem("tituloGasto");
    nombreGastoProv = nombreGastoProv.split("°")[1];
    var idSiniestro = window.localStorage.getItem("idSiniestroServidor");
    idSiniestro = idSiniestro ? idSiniestro : 0;

    sqlQuery('SELECT * FROM Gasto WHERE idGasto = ?', [idGasto], function(gasto){
        if(gasto != true){
            gastos_repor_id_anti = gasto[0].gastos_repor_id;
            gastos_repor_nombre = gasto[0].gastos_repor_nombre;
        }
        var mailParams = {
            anio: fech_ini.split("-")[0],
            mes: fech_ini.split("-")[1],
            dia: fech_ini.split("-")[2],
            anio_2: fech_fin.split("-")[0],
            mes_2: fech_fin.split("-")[1],
            dia_2: fech_fin.split("-")[2],
            gastos_repor_nombre:gastos_repor_nombre?gastos_repor_nombre:nombreGastoProv,
            gastos_repor_mail:gastos_repor_mail,
            gastos_repor_coment:gastos_repor_coment,
            gastos_repor_id_anti:gastos_repor_id_anti?gastos_repor_id_anti:idGasto,
            siniestro: idSiniestro,
            idGasto:idGasto
        }
        gastoLog.debug('enviar correo', mailParams);

        if(verificarConexion() == true){
            sqlQuery('INSERT INTO SendMailGasto (anio,'
                    + ' mes,'
                    + ' dia,'
                    + ' anio_2,'
                    + ' mes_2, '
                    + 'dia_2, '
                    + 'gastos_repor_nombre, '
                    + 'gastos_repor_mail, '
                    + 'gastos_repor_coment, '
                    + 'gastos_repor_id_anti, '
                    + 'siniestro,'
                    + 'fk_idGasto) VALUES (?,?,?,?,?,?,?,?,?,?,?,?)', 
                    fn.JsonToArray(mailParams), function(last_id){
                    guardarPeticion('envio_reporte.php', 'POST', 'SendMailGasto', 'idMail', last_id, function(success){
                        showNotice('El correo se enviará en un momento');
                        backReporteGasto();
                        syncLocalData('sync');
                    });
                }, true);
        }else{
            sqlQuery('INSERT INTO SendMailGasto (anio,'
                    + ' mes,'
                    + ' dia,'
                    + ' anio_2,'
                    + ' mes_2, '
                    + 'dia_2, '
                    + 'gastos_repor_nombre, '
                    + 'gastos_repor_mail, '
                    + 'gastos_repor_coment, '
                    + 'gastos_repor_id_anti, '
                    + 'siniestro,' 
                    + 'fk_idGasto) VALUES (?,?,?,?,?,?,?,?,?,?,?,?)', 
                    fn.JsonToArray(mailParams), function(last_id){
                        guardarPeticion('envio_reporte.php', 'POST', 'SendMailGasto', 'idMail', last_id, function(success){
                            showNotice('El correo se enviará en cuanto exista una conexión a Internet disponible');
                            backReporteGasto();
                        });
                    }, true);
        }
    });
}

/**************************************************************
                    * DETALLE DE GASTO*
 **************************************************************/


/**
 * Funcion para regresar a gastos
 */
function backReporteGasto() {
    // si esta en la pantalla de nuevo gasto y esta eligiendo un ajustador
    // se debe ocultar la seleccion del ajustador
    let seleccionAjustador = document.getElementById('seleccionarAjustador');
    if (seleccionAjustador != null &amp;&amp; seleccionAjustador.style.display == 'block') {
        document.querySelectorAll('ons-card').forEach(card => card.style.display = 'block');
        document.getElementById('seleccionarAjustador').style.display = 'none';
        return;
    }
    var idGasto = window.localStorage.getItem("idGasto");
    window.localStorage.removeItem("comprob1");
    verReporteGasto(null, idGasto);
}

/**
 * Función que inicializa los datos
 * del formulario para agregar un
 * nuevo detalle gastos
 */
function initNuevoDetalle() {
    let titleApp = window.localStorage.getItem("titleApp");
    let idSiniestro = window.localStorage.getItem("idSiniestroServidor");
    return cargarPagina()
        .then(mostrarConceptos)
        .then(mostrarDatosUsuario);

    function cargarPagina() {
        return fn.load('detalleReporteGasto.html').then(() => {
            document.querySelector('[data-seleccionar-ajustador]').style.display = 'none';
            document.querySelector('[data-limpiar-ajustador]').style.display = 'none';
        })
    }

    function mostrarConceptos() {
        return CatalogoService.obtenerListadoConceptos().then(conceptos => {
            let selectConceptos = '';
            let monedaGasto = window.localStorage.getItem("monedaGasto");
            selectConceptos += '&lt;ons-select id="select_conceptos" name="select_conceptos" required>';
            conceptos.forEach(function (concepto) {
                selectConceptos += '&lt;option value="' + concepto.concepto_id + '" >' + concepto.concepto_tex + '&lt;/option>';
            });
            selectConceptos += '&lt;/ons-select>'
            $('#gastos_concepto').html(selectConceptos);
            $('#titleApp').html(titleApp);
            $('#titlePage').html('Nuevo Gasto');
            $('#gastos_moneda').html(monedaGasto);
        });
    }

    function mostrarDatosUsuario() {
        return CatalogoService.obtenerDatosUsuarioActual().then(datosUsuario => {
            $('[data-ajustador-nombre]').val(datosUsuario.user_nombre);
            $('[data-ajustador-nombre-defecto]').val(datosUsuario.user_nombre);
            $('[data-ajustador-iniciales]').val(datosUsuario.user_iniciales);
            $('[data-ajustador-iniciales-defecto]').val(datosUsuario.user_iniciales);
            $('[data-ajustador-id]').val(datosUsuario.user_id);
            $('[data-ajustador-id-defecto]').val(datosUsuario.user_id);
            $('#gastos_fecha_real').val(obtenerFecha(new Date()));
        }).finally(() => {
            loadActionSheet('imageOptions.html');
            TablaDetalleGasto.optionsDetalleGasto('nuevo');
            validateNuevoDetalleGasto();
        })
    }
}


/**
 * Función que valida el formulario para agregar
 * un nuevo detalle gasto
 */
function validateNuevoDetalleGasto(){
    $('#nuevoDetalleGasto').validate({
        errorClass: "errorForm",
        validClass: "validForm",
        submitHandler: function(){
            var photo = $('#gastos_archivo').val();
            if(photo.trim() != ''){
                var accionSig;
                if(salir == true){
                    accionSig = 'salir';
                }else{
                    accionSig = 'nuevo';
                }
                // guardarNuevoDetalle(accionSig);
                TablaDetalleGasto.guardarNuevoDetalle(accionSig);
            }else{
                showError('Se debe cargar la fotografía del comprobante');
            }
        },
        invalidHandler: function (event, validator){
            if(validator.numberOfInvalids()){
                showError("Revisa los campos marcados");
            }
        }
    });
}

function submitNuevoDetalleSalir(){
    salir = true;
    $('#nuevoDetalleGasto').submit();
}

function submitNuevoDetalleNuevo(){
    salir = false;
    $('#nuevoDetalleGasto').submit();
}


function detalleGastoToJson(detalleGasto) {
    var params = {
        gastos_movil_caso: detalleGasto.gastos_movil_caso,
        anio: detalleGasto.anio,
        mes: detalleGasto.mes,
        dia: detalleGasto.dia,
        gastos_ajustador: detalleGasto.gastos_ajustador,
        gastos_repor_id: detalleGasto.gastos_repor_id,
        gastos_valor: detalleGasto.gastos_valor,
        gastos_cargar: detalleGasto.gastos_cargar,
        gastos_moneda: detalleGasto.gastos_moneda,
        gastos_emisor: detalleGasto.gastos_emisor,
        gastos_descripcion: detalleGasto.gastos_descripcion,
        gastos_concepto: detalleGasto.gastos_concepto,
        gastos_razon_social: detalleGasto.gastos_razon_social,
        gastos_amex: detalleGasto.gastos_amex,
        dataUri: detalleGasto.up_documento_2
    }
    return params;
}

function documentoGastoToJson(documentoGasto){
    var documentoGastoJson = {
        gasto_id: documentoGasto.gasto_id, 
        filetype: documentoGasto.filetype,
        up_documento: documentoGasto.up_documento,
        dataUri: documentoGasto.up_documento
    }
    return documentoGastoJson;
}

function showModalGastos() {
    var modal = document.querySelector('ons-modal');
    modal.show();
}

function ListadoAjustadores() {
    return CatalogoService.obtenerListadoAjustadores().then(ajustadores => {
        let items = ajustadores.map(ajustador => `
            &lt;ons-list-item data-id='${ajustador.id}' data-nombre='${ajustador.nombre}' 
                    data-iniciales='${ajustador.iniciales}'>
                ${ajustador.nombre}
            &lt;/ons-list-item>
        `).join('')
        document.querySelector('[data-seleccionar-ajustador] ons-list').innerHTML = items;
        document.querySelector('[data-seleccionar-ajustador]').style.display = 'block';
        document.querySelector('[data-seleccionar-ajustador] input').oninput = filtrarListado;
        document.querySelectorAll('[data-seleccionar-ajustador] ons-list-item').forEach(item => {
            item.onclick = e => seleccionarAjustador(item);
        })
        document.querySelector('[data-seleccionar-ajustador] input').value = '';
        document.querySelectorAll('ons-card').forEach(card => card.style.display = 'none');
    })

    function seleccionarAjustador(item) {
        document.querySelectorAll('ons-card').forEach(card => card.style.display = 'block');
        document.querySelector('[data-seleccionar-ajustador]').style.display = 'none';
        document.querySelector('[data-ajustador-id]').value = item.dataset.id;
        document.querySelector('[data-ajustador-nombre]').value = item.dataset.nombre;
        document.querySelector('[data-ajustador-iniciales]').value = item.dataset.iniciales;
        document.querySelector('[data-limpiar-ajustador]').style.display = 'inline';
        document.querySelector('[data-limpiar-ajustador]').onclick = limpiarAjustadorSeleccionado;
    }

    function limpiarAjustadorSeleccionado() {
        document.querySelector('[data-limpiar-ajustador]').style.display = 'none';
        document.querySelector('[data-ajustador-nombre]').value =
            document.querySelector('[data-ajustador-nombre-defecto]').value;
        document.querySelector('[data-ajustador-iniciales]').value =
            document.querySelector('[data-ajustador-iniciales-defecto]').value;
        if (document.querySelector('[data-ajustador-id-defecto]') == null) {
            document.querySelector('[data-ajustador-id-defecto]').value = '';
        } else {
            document.querySelector('[data-ajustador-id]').value =
                document.querySelector('[data-ajustador-id-defecto]').value;
        }
    }

    function filtrarListado() {
        let busqueda = document.querySelector('[data-seleccionar-ajustador] input').value;
        if (busqueda.trim() != '') {
            document.querySelectorAll('[data-seleccionar-ajustador] ons-list-item').forEach(item => {
                let nombreUpper = item.dataset.nombre.toUpperCase();
                let busquedaUpper = busqueda.toUpperCase();
                if (nombreUpper.includes(busquedaUpper)) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        } else {
            document.querySelectorAll('[data-seleccionar-ajustador] ons-list-item').forEach(item => {
                item.style.display = 'block';
            });
        }
    }
}</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-GestureDetector.html">GestureDetector</a></li><li><a href="module-gestures.html">gestures</a></li></ul><h3>Classes</h3><ul><li><a href="-_anonymous_-GestureDetector.Instance.html">Instance</a></li><li><a href="CatalogoService.html">CatalogoService</a></li><li><a href="DialogoCerrarSesion.html">DialogoCerrarSesion</a></li><li><a href="DialogoNuevoUsuario.html">DialogoNuevoUsuario</a></li><li><a href="DialogoRestablecer.html">DialogoRestablecer</a></li><li><a href="GastosService.html">GastosService</a></li><li><a href="InspeccionFotografia.html">InspeccionFotografia</a></li><li><a href="InspeccionSubirDocumento.html">InspeccionSubirDocumento</a></li><li><a href="InspeccionTablaFotografias.html">InspeccionTablaFotografias</a></li><li><a href="ListadoPeticiones.html">ListadoPeticiones</a></li><li><a href="module-GestureDetector.Detection.html">Detection</a></li><li><a href="module-GestureDetector.Event.html">Event</a></li><li><a href="module-GestureDetector.PointerEvent.html">PointerEvent</a></li><li><a href="module-gestures.Drag.html">Drag</a></li><li><a href="module-gestures.Gesture.html">Gesture</a></li><li><a href="module-gestures.Hold.html">Hold</a></li><li><a href="module-gestures.Release.html">Release</a></li><li><a href="module-gestures.Swipe.html">Swipe</a></li><li><a href="module-gestures.Tap.html">Tap</a></li><li><a href="module-gestures.Touch.html">Touch</a></li><li><a href="module-gestures.Transform.html">Transform</a></li><li><a href="PeticionesDao.html">PeticionesDao</a></li><li><a href="TablaDetalleGasto.html">TablaDetalleGasto</a></li><li><a href="Utils.html">Utils</a></li></ul><h3>Events</h3><ul><li><a href="module-gestures.html#~event:change">change</a></li><li><a href="module-gestures.html#~event:changestate">changestate</a></li><li><a href="module-gestures.html#~event:close">close</a></li><li><a href="module-gestures.html#~event:destroy">destroy</a></li><li><a href="module-gestures.html#~event:doubletap">doubletap</a></li><li><a href="module-gestures.html#~event:drag">drag</a></li><li><a href="module-gestures.html#~event:dragdown">dragdown</a></li><li><a href="module-gestures.html#~event:dragend">dragend</a></li><li><a href="module-gestures.html#~event:dragright">dragright</a></li><li><a href="module-gestures.html#~event:dragstart">dragstart</a></li><li><a href="module-gestures.html#~event:dragup">dragup</a></li><li><a href="module-gestures.html#~event:drapleft">drapleft</a></li><li><a href="module-gestures.html#~event:gesture">gesture</a></li><li><a href="module-gestures.html#~event:hide">hide</a></li><li><a href="module-gestures.html#~event:hold">hold</a></li><li><a href="module-gestures.html#~event:init">init</a></li><li><a href="module-gestures.html#~event:modechange">modechange</a></li><li><a href="module-gestures.html#~event:open">open</a></li><li><a href="module-gestures.html#~event:overscroll">overscroll</a></li><li><a href="module-gestures.html#~event:pinchin">pinchin</a></li><li><a href="module-gestures.html#~event:pinchout">pinchout</a></li><li><a href="module-gestures.html#~event:postchange">postchange</a></li><li><a href="module-gestures.html#~event:postclose">postclose</a></li><li><a href="module-gestures.html#~event:posthide">posthide</a></li><li><a href="module-gestures.html#~event:postopen">postopen</a></li><li><a href="module-gestures.html#~event:postpop">postpop</a></li><li><a href="module-gestures.html#~event:postpush">postpush</a></li><li><a href="module-gestures.html#~event:postshow">postshow</a></li><li><a href="module-gestures.html#~event:prechange">prechange</a></li><li><a href="module-gestures.html#~event:preclose">preclose</a></li><li><a href="module-gestures.html#~event:prehide">prehide</a></li><li><a href="module-gestures.html#~event:preopen">preopen</a></li><li><a href="module-gestures.html#~event:prepop">prepop</a></li><li><a href="module-gestures.html#~event:prepush">prepush</a></li><li><a href="module-gestures.html#~event:preshow">preshow</a></li><li><a href="module-gestures.html#~event:reactive">reactive</a></li><li><a href="module-gestures.html#~event:refresh">refresh</a></li><li><a href="module-gestures.html#~event:release">release</a></li><li><a href="module-gestures.html#~event:rotate">rotate</a></li><li><a href="module-gestures.html#~event:show">show</a></li><li><a href="module-gestures.html#~event:swipe">swipe</a></li><li><a href="module-gestures.html#~event:swipedown">swipedown</a></li><li><a href="module-gestures.html#~event:swipeleft">swipeleft</a></li><li><a href="module-gestures.html#~event:swiperight">swiperight</a></li><li><a href="module-gestures.html#~event:swipeup">swipeup</a></li><li><a href="module-gestures.html#~event:tap">tap</a></li><li><a href="module-gestures.html#~event:touch">touch</a></li><li><a href="module-gestures.html#~event:transform">transform</a></li><li><a href="module-gestures.html#~event:transformend">transformend</a></li><li><a href="module-gestures.html#~event:transformstart">transformstart</a></li></ul><h3>Global</h3><ul><li><a href="global.html#abrirDocumentoConAplicacionDeTerceros">abrirDocumentoConAplicacionDeTerceros</a></li><li><a href="global.html#abrirNuevaInspeccion">abrirNuevaInspeccion</a></li><li><a href="global.html#actualizarEstatusPeticion">actualizarEstatusPeticion</a></li><li><a href="global.html#actualizarListadoGasto">actualizarListadoGasto</a></li><li><a href="global.html#appLog">appLog</a></li><li><a href="global.html#b64toBlob">b64toBlob</a></li><li><a href="global.html#backReporteGasto">backReporteGasto</a></li><li><a href="global.html#backVerInspeccion">backVerInspeccion</a></li><li><a href="global.html#baseDatosLog">baseDatosLog</a></li><li><a href="global.html#bitacora">bitacora</a></li><li><a href="global.html#buscarInspeccionSinSiniestro">buscarInspeccionSinSiniestro</a></li><li><a href="global.html#buscarReferencia">buscarReferencia</a></li><li><a href="global.html#buscarSiniestro">buscarSiniestro</a></li><li><a href="global.html#cambiarSiniestro">cambiarSiniestro</a></li><li><a href="global.html#cambiarTareaNoFact">cambiarTareaNoFact</a></li><li><a href="global.html#cargarSelect">cargarSelect</a></li><li><a href="global.html#clearPeticiones">clearPeticiones</a></li><li><a href="global.html#closeModal">closeModal</a></li><li><a href="global.html#CONFIGURACION_LOGGER">CONFIGURACION_LOGGER</a></li><li><a href="global.html#constructor">constructor</a></li><li><a href="global.html#consultarGastos">consultarGastos</a></li><li><a href="global.html#contentLoadedFotografias">contentLoadedFotografias</a></li><li><a href="global.html#crearDocumento">crearDocumento</a></li><li><a href="global.html#crearInspeccion">crearInspeccion</a></li><li><a href="global.html#createDatabase">createDatabase</a></li><li><a href="global.html#datos">datos</a></li><li><a href="global.html#deleteBitacora">deleteBitacora</a></li><li><a href="global.html#deleteDatabase">deleteDatabase</a></li><li><a href="global.html#deletePeticion">deletePeticion</a></li><li><a href="global.html#DescripcionPeticion">DescripcionPeticion</a></li><li><a href="global.html#dialogoComfirmarCambiosInspeccion">dialogoComfirmarCambiosInspeccion</a></li><li><a href="global.html#dialogoEditarInspeccion">dialogoEditarInspeccion</a></li><li><a href="global.html#docFotoToJson">docFotoToJson</a></li><li><a href="global.html#documento">documento</a></li><li><a href="global.html#downloadLogFile">downloadLogFile</a></li><li><a href="global.html#downloadPDF">downloadPDF</a></li><li><a href="global.html#downloadPhoto">downloadPhoto</a></li><li><a href="global.html#downloadPhotos">downloadPhotos</a></li><li><a href="global.html#dropDatabasePromise">dropDatabasePromise</a></li><li><a href="global.html#enviarPeticionesPendientes">enviarPeticionesPendientes</a></li><li><a href="global.html#faltanDatosSiniestro">faltanDatosSiniestro</a></li><li><a href="global.html#FormatearPeticion">FormatearPeticion</a></li><li><a href="global.html#FormularioInspeccion">FormularioInspeccion</a></li><li><a href="global.html#fotoInspeccionToJson">fotoInspeccionToJson</a></li><li><a href="global.html#getBitacoraData">getBitacoraData</a></li><li><a href="global.html#getBitacoraParams">getBitacoraParams</a></li><li><a href="global.html#getDataReporteGasto">getDataReporteGasto</a></li><li><a href="global.html#getGastoData">getGastoData</a></li><li><a href="global.html#getGastoParams">getGastoParams</a></li><li><a href="global.html#getLogger">getLogger</a></li><li><a href="global.html#getUUID">getUUID</a></li><li><a href="global.html#guardarBitacora">guardarBitacora</a></li><li><a href="global.html#guardarBitacoraFacturableYNueva">guardarBitacoraFacturableYNueva</a></li><li><a href="global.html#guardarBitacoraFacturableYSalir">guardarBitacoraFacturableYSalir</a></li><li><a href="global.html#guardarBitacoraNoFacturableYNueva">guardarBitacoraNoFacturableYNueva</a></li><li><a href="global.html#guardarBitacoraNoFacturableYSalir">guardarBitacoraNoFacturableYSalir</a></li><li><a href="global.html#guardarBitacoras">guardarBitacoras</a></li><li><a href="global.html#guardarCambioBitacora">guardarCambioBitacora</a></li><li><a href="global.html#guardarCambios">guardarCambios</a></li><li><a href="global.html#guardarConceptos">guardarConceptos</a></li><li><a href="global.html#guardarEstadoInspeccion">guardarEstadoInspeccion</a></li><li><a href="global.html#guardarGrupoDocumento">guardarGrupoDocumento</a></li><li><a href="global.html#guardarMonedas">guardarMonedas</a></li><li><a href="global.html#guardarNuevoGasto">guardarNuevoGasto</a></li><li><a href="global.html#guardarPeticion">guardarPeticion</a></li><li><a href="global.html#guardarPeticionPromise">guardarPeticionPromise</a></li><li><a href="global.html#guardarSiniestro">guardarSiniestro</a></li><li><a href="global.html#guardarSubtarea">guardarSubtarea</a></li><li><a href="global.html#guardarTarea">guardarTarea</a></li><li><a href="global.html#guardarTipoAnexo">guardarTipoAnexo</a></li><li><a href="global.html#guardarTipoFoto">guardarTipoFoto</a></li><li><a href="global.html#initBitacora">initBitacora</a></li><li><a href="global.html#initNuevoDetalle">initNuevoDetalle</a></li><li><a href="global.html#initNuevoGasto">initNuevoGasto</a></li><li><a href="global.html#initRefSin">initRefSin</a></li><li><a href="global.html#initResultadosSiniestro">initResultadosSiniestro</a></li><li><a href="global.html#initSendGastos">initSendGastos</a></li><li><a href="global.html#inspeccion">inspeccion</a></li><li><a href="global.html#inspeccionBuscarSin">inspeccionBuscarSin</a></li><li><a href="global.html#inspeccionCambioRegistrado">inspeccionCambioRegistrado</a></li><li><a href="global.html#inspeccionHabilitarEditarSiniestro">inspeccionHabilitarEditarSiniestro</a></li><li><a href="global.html#InspeccionService">InspeccionService</a></li><li><a href="global.html#isSynced">isSynced</a></li><li><a href="global.html#lastUserAct">lastUserAct</a></li><li><a href="global.html#limpiarCampos">limpiarCampos</a></li><li><a href="global.html#loadBitacora">loadBitacora</a></li><li><a href="global.html#loadSubtareas">loadSubtareas</a></li><li><a href="global.html#Migraciones">Migraciones</a></li><li><a href="global.html#mostrarGastos">mostrarGastos</a></li><li><a href="global.html#mostrarInspeccion">mostrarInspeccion</a></li><li><a href="global.html#mostrarNuevaInspeccion">mostrarNuevaInspeccion</a></li><li><a href="global.html#mostrarReporteGasto">mostrarReporteGasto</a></li><li><a href="global.html#nuevaBitacoraNoFacturable">nuevaBitacoraNoFacturable</a></li><li><a href="global.html#obtenerFecha">obtenerFecha</a></li><li><a href="global.html#obtenerFechaHHMMSS">obtenerFechaHHMMSS</a></li><li><a href="global.html#openEnviarIns">openEnviarIns</a></li><li><a href="global.html#openFotografiasCargadas">openFotografiasCargadas</a></li><li><a href="global.html#openPhotoCamera">openPhotoCamera</a></li><li><a href="global.html#openPhotoLibrary">openPhotoLibrary</a></li><li><a href="global.html#optionBitaFact">optionBitaFact</a></li><li><a href="global.html#paginasTotales">paginasTotales</a></li><li><a href="global.html#panelUsuario">panelUsuario</a></li><li><a href="global.html#progressBar">progressBar</a></li><li><a href="global.html#reducePictureSize">reducePictureSize</a></li><li><a href="global.html#refLog">refLog</a></li><li><a href="global.html#resetAllError">resetAllError</a></li><li><a href="global.html#resolveLocalDevicePath">resolveLocalDevicePath</a></li><li><a href="global.html#resultadosBitacora">resultadosBitacora</a></li><li><a href="global.html#resultadosDatos">resultadosDatos</a></li><li><a href="global.html#resultadosInspeccion">resultadosInspeccion</a></li><li><a href="global.html#resultadosInspeccionSin">resultadosInspeccionSin</a></li><li><a href="global.html#rowsAsList">rowsAsList</a></li><li><a href="global.html#savebase64AsPDF">savebase64AsPDF</a></li><li><a href="global.html#saveDataUser">saveDataUser</a></li><li><a href="global.html#saveEmail">saveEmail</a></li><li><a href="global.html#savePhotoFile">savePhotoFile</a></li><li><a href="global.html#saveRequest">saveRequest</a></li><li><a href="global.html#saveResponse">saveResponse</a></li><li><a href="global.html#select">select</a></li><li><a href="global.html#sendCambiosBitacora">sendCambiosBitacora</a></li><li><a href="global.html#sendMail">sendMail</a></li><li><a href="global.html#sendPeticiones">sendPeticiones</a></li><li><a href="global.html#setDataSiniestro">setDataSiniestro</a></li><li><a href="global.html#setOptions">setOptions</a></li><li><a href="global.html#showFotosCargadas">showFotosCargadas</a></li><li><a href="global.html#showModal">showModal</a></li><li><a href="global.html#sqlError">sqlError</a></li><li><a href="global.html#sqlPromise">sqlPromise</a></li><li><a href="global.html#sqlQuery">sqlQuery</a></li><li><a href="global.html#stringToBlob">stringToBlob</a></li><li><a href="global.html#submitDocumentoCargado">submitDocumentoCargado</a></li><li><a href="global.html#submitInspeccionSeleccionada">submitInspeccionSeleccionada</a></li><li><a href="global.html#submitNuevasFotografias">submitNuevasFotografias</a></li><li><a href="global.html#submitRepoGasto">submitRepoGasto</a></li><li><a href="global.html#submitValidateGastosReport">submitValidateGastosReport</a></li><li><a href="global.html#syncLocalData">syncLocalData</a></li><li><a href="global.html#takePhoto">takePhoto</a></li><li><a href="global.html#updateAnticipo">updateAnticipo</a></li><li><a href="global.html#updateBitacora">updateBitacora</a></li><li><a href="global.html#updateBitaNoFact">updateBitaNoFact</a></li><li><a href="global.html#updateEstado">updateEstado</a></li><li><a href="global.html#updateLocalData">updateLocalData</a></li><li><a href="global.html#updateNombreFoto">updateNombreFoto</a></li><li><a href="global.html#updatePagesGasto">updatePagesGasto</a></li><li><a href="global.html#uploadFile">uploadFile</a></li><li><a href="global.html#validacionNuevaBitacora">validacionNuevaBitacora</a></li><li><a href="global.html#validarInspeccionSinSiniestro">validarInspeccionSinSiniestro</a></li><li><a href="global.html#validateDocumentoCargado">validateDocumentoCargado</a></li><li><a href="global.html#validateEnviarIns">validateEnviarIns</a></li><li><a href="global.html#validateGastosReport">validateGastosReport</a></li><li><a href="global.html#validateNuevasFotografias">validateNuevasFotografias</a></li><li><a href="global.html#validateNuevoDetalleGasto">validateNuevoDetalleGasto</a></li><li><a href="global.html#validateNuevoRepGasto">validateNuevoRepGasto</a></li><li><a href="global.html#value">value</a></li><li><a href="global.html#verBitacora">verBitacora</a></li><li><a href="global.html#verInspeccion">verInspeccion</a></li><li><a href="global.html#verInspeccionSin">verInspeccionSin</a></li><li><a href="global.html#verReporteGasto">verReporteGasto</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.4</a> on Fri Oct 16 2020 08:31:37 GMT-0700 (Pacific Daylight Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
